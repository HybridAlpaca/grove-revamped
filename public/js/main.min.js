webpackJsonp([0],[function(e,t,i){"use strict";var r=i(1),a=i(2),n=i(8),o=e.exports=new Map;o.set("time",Date.now()),o.set("tick",0),o.set("controls",{}),o.set("scene",new r.Scene),o.set("renderer",new r.WebGLRenderer),o.set("camera",new r.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,5e3)),o.set("listener",new r.AudioListener),o.get("camera").add(o.get("listener")),o.set("player",{}),o.set("entities",[]),o.set("labels",[]),o.set("tweens",[]),o.set("world",new a.World),o.set("cache",{audio:{},json:{}}),o.set("events",n.channel("events")),o.set("load",function(e,t){t=t||{},e.castShadow=!0,e.receiveShadow=!0;for(var i=[],r=[],n=0;n<e.geometry.vertices.length;n++){var s=e.geometry.vertices[n];i.push(new a.Vec3(s.x,s.y,s.z))}for(var n=0;n<e.geometry.faces.length;n++){var l=e.geometry.faces[n];r.push([l.a,l.b,l.c])}var c=new a.ConvexPolyhedron(i,r),u=new a.Body({mass:t.mass||0,material:t.material||void 0});return u.addShape(c),u.position.copy(e.position),u.quaternion.copy(e.quaternion),o.get("world").add(u),{body:u,shape:c,mesh:e}})},,,,function(e,t,i){"use strict";function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function e(t,i,r){null===t&&(t=Function.prototype);var a=Object.getOwnPropertyDescriptor(t,i);if(void 0===a){var n=Object.getPrototypeOf(t);return null===n?void 0:e(n,i,r)}if("value"in a)return a.value;var o=a.get;if(void 0!==o)return o.call(r)},s=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),l=i(1),c=i(2),u=i(0),h=i(3),p=t.Entity=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Entity",i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new l.Object3D,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new c.Body,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(n(this,e),console.log("Entity: "+t+" created"),this.id=t,this.uuid=Math.random(),this.events={},this.opts=a,this.sounds=[],this.opts.sounds)for(var o=0;o<this.opts.sounds.length;o++)this.loadAudio(this.opts.sounds[o],o);this.mesh=i,this.mesh.name=this.id,this.body=r,u.get("scene").add(i),u.get("world").add(r),u.get("entities").push(this)}return s(e,[{key:"update",value:function(e){this.mesh.position.copy(this.body.position),this.callEvent("update")}},{key:"remove",value:function(){this.callEvent("remove"),u.get("scene").remove(this.mesh),u.get("world").remove(this.body),u.get("entities").splice(u.get("entities").indexOf(this),1)}},{key:"loadAudio",value:function(e,t){var i=this;if(e)if(u.get("cache").audio[e])this.sounds[t]=new l.PositionalAudio(u.get("listener")),this.sounds[t].setBuffer(u.get("cache").audio[e]),this.sounds[t].setRefDistance(30),this.mesh&&this.mesh.add(this.sounds[t]),this.sounds[t].onEnded(function(){return i.sounds[t].stop()});else{var r=new l.AudioLoader;r.load("/assets/sfx/"+e,function(r){u.get("cache").audio[e]=r,i.sounds[t]=new l.PositionalAudio(u.get("listener")),i.sounds[t].setBuffer(r),i.sounds[t].setRefDistance(30),i.mesh.add(i.sounds[t]),i.sounds[t].onEnded(function(){return i.sounds[t].stop()})})}}},{key:"addEventListener",value:function(e,t){e in this.events||(this.events[e]=[]),this.events[e].push(t)}},{key:"removeEventListener",value:function(e,t){}},{key:"callEvent",value:function(e){if(e in this.events){for(var t=arguments.length,i=Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];var a=!0,n=!1,o=void 0;try{for(var s,l=this.events[e][Symbol.iterator]();!(a=(s=l.next()).done);a=!0){s.value.apply(void 0,i)}}catch(e){n=!0,o=e}finally{try{!a&&l.return&&l.return()}finally{if(n)throw o}}}}}]),e}(),d=t.Living=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Living Entity",i=arguments[1],a=arguments[2],o=arguments[3];n(this,t);var s=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,a,o));return s.lastDamaged=0,s.lastAttacked=0,s.lastUsedStamina=0,s.lastUsedMagic=0,s.hp=Number,s.hpMax=Number,s.mp=Number,s.mpMax=Number,s.stm=Number,s.stmMax=Number,s.lvl=1,s.xp=0,s.xpMax=Math.pow(s.lvl,2)/.04,s.str=Number,s.dex=Number,s.int=Number,s.cnt=Number,s.chr=Number,s.inv=[],s.effects=[],s}return a(t,e),s(t,[{key:"gainXP",value:function(e){this.xp+=e,this.xpMax=Math.pow(this.lvl,2)/.04,this.xp>this.xpMax&&(this.lvl++,this.xp=0,this.callEvent("levelUp"))}},{key:"attack",value:function(e){u.get("controls").enabled&&(e.damage(this.dmg,this),this.lastAttacked=Date.now(),this.callEvent("attack"))}},{key:"damage",value:function(e,t){u.get("controls").enabled&&(this.hp-=e,this.hp<=0&&this.kill(t),this.lastDamaged=Date.now(),this.callEvent("damage"))}},{key:"heal",value:function(e,t,i){u.get("controls").enabled&&(this.hp+=e,this.mp+=i,this.stm+=t,this.hp>=this.hpMax&&(this.hp=this.hpMax),this.mp>=this.mpMax&&(this.mp=this.mpMax),this.stm>=this.stmMax&&(this.stm=this.stmMax),this.callEvent("heal"))}},{key:"kill",value:function(e){u.get("controls").enabled&&(this.remove(),this.callEvent("kill",{attacker:e}))}},{key:"update",value:function(e){o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"update",this).call(this,e),this.heal(Date.now()-this.lastDamaged>5e3?.1:0,Date.now()-this.lastUsedStamina>2e3?.1:0,Date.now()-this.lastUsedMagic>2e3?.1:0)}}]),t}(p),m=t.AI=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"AI",i=arguments[1],a=arguments[2],o=arguments[3];n(this,t);var s=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,a,o));return s.target=null,s.seen=!1,s.hp=5,s.hpMax=5,s.mp=1,s.mpMax=1,s.stm=3,s.stmMax=3,s.str=1,s.dex=1,s.int=1,s.cnt=1,s.chr=1,s}return a(t,e),s(t,[{key:"update",value:function(e){var i=this;o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"update",this).call(this,e);var r=this.mesh.position,a=!0,n=!1,s=void 0;try{for(var c,h=u.get("entities")[Symbol.iterator]();!(a=(c=h.next()).done);a=!0){var p=c.value;p.id!=this.id&&(r.distanceTo(p.mesh.position)>50||this.data&&this.data.hostility&&this.data.hostility[1].has(p.id)||(this.target&&r.distanceTo(p.mesh.position)<r.distanceTo(this.target.mesh.position)?(this.target=p,this.sounds[0]&&this.hp>0&&u.get("controls").enabled&&this.sounds[0].play(),this.callEvent("newTarget",this.target)):this.target||(this.target=p,this.sounds[0]&&this.hp>0&&u.get("controls").enabled&&this.sounds[0].play(),this.callEvent("newTarget",this.target))))}}catch(e){n=!0,s=e}finally{try{!a&&h.return&&h.return()}finally{if(n)throw s}}this.target&&r.distanceTo(this.target.mesh.position)>50&&(this.target=null);var d=this.spd||7;if(this.addEventListener("damage",function(){i.sounds[2]&&i.hp>0&&u.get("controls").enabled&&!i.sounds[2].isPlaying&&i.hp>0&&i.sounds[2].play()}),this.addEventListener("kill",function(){i.sounds[3]&&i.hp>0&&u.get("controls").enabled&&!i.sounds[3].isPlaying&&i.sounds[3].play()}),this.target){var m=this.target.mesh.position;this.mesh.lookAt(new l.Vector3(m.x,this.mesh.position.y,m.z));var f=0;f=this.data&&this.data.hostility[0].has(this.target.id)?-1:this.data&&this.data.hostility[2].has(this.target.id)?1:this.opts.hostility,this.hostility=f;var y=1;f>0&&(y*=-1),0!=f&&r.distanceTo(m)>(f>0?10:5)?(r.x<m.x?this.body.velocity.x+=y:r.x>m.x&&(this.body.velocity.x-=y),r.z<m.z?this.body.velocity.z+=y:r.z>m.z&&(this.body.velocity.z-=y)):u.get("tick")%50==0&&f<0&&(this.attack(this.target),this.sounds[1]&&u.get("controls").enabled&&this.sounds[1].play())}else this.body.velocity.x=0,this.body.velocity.z=0;this.body.velocity.x>d?this.body.velocity.x=d:this.body.velocity.x<-d&&(this.body.velocity.x=-d),this.body.velocity.z>d?this.body.velocity.z=d:this.body.velocity.z<-d&&(this.body.velocity.z=-d)}}]),t}(d);t.Creature=function(e){function t(e,a){n(this,t);var o=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,new l.Object3D,new c.Body,a)),s=i(13);if(!s[e])throw new Error("Error: cannot find creature with id of "+e);var h=s[e];o.data=h,o.id=o.data.id,o.inv=h.inv;for(var p in h.stats)o[p]=h.stats[p];return(new l.ObjectLoader).load("/assets/3d/"+h.path+".json",function(e){u.get("cache").json[h.path]=e;var t=new c.Body({mass:5});t.addShape(new c.Sphere(1));var i=void 0;if(i=new c.Vec3(a.pos.x||10,a.pos.y||20,a.pos.z||10),h.meta&&h.meta.spawn){var r=h.meta.spawn;i=6==r.length?new c.Vec3(Math.interval(r[0],r[1]),Math.interval(r[2],r[3]),Math.interval(r[4],r[5])):new c.Vec3(r[0],r[1],r[2])}var n=new l.Raycaster(new l.Vector3(i.x,i.y,i.z),new l.Vector3(0,-1,0)),s=n.intersectObjects(u.get("scene").children,!0);if(s.length>0){var p=s[0].point;t.position.set(p.x,p.y+3,p.z)}else t.position.set(i.x,i.y,i.z);t.linearDamping=.9,e.traverse(function(e){var t=!0,i=!1,r=void 0;try{for(var a,n=h.mesh[Symbol.iterator]();!(t=(a=n.next()).done);t=!0){var o=a.value;if(o.name.toLowerCase()==e.name.toLowerCase())for(var s in o)e.material[s]=o[s],"color"==s&&(e.material[s]=new l.Color(o[s]))}}catch(e){i=!0,r=e}finally{try{!t&&n.return&&n.return()}finally{if(i)throw r}}}),o.mesh=e,u.get("scene").add(o.mesh),o.body=t,u.get("world").add(o.body)}),o.addEventListener("kill",function(t){var r=!0,a=!1,n=void 0;try{for(var s,l=o.inv[Symbol.iterator]();!(r=(s=l.next()).done);r=!0){var c=s.value,h=i(6);if(!h[c.id])throw new Error("Error: cannot find item with id of "+e);var p=Math.round(Math.random()*c.max)+c.min;if(p>c.max&&(p=c.max),p){for(var d=0;d<p;d++)t.attacker.inv.push(h[c.id]);t.attacker==u.get("player")&&(p>1?Materialize.toast(c.id+" ("+p+") added",1e3):Materialize.toast(c.id+" added",1e3))}}}catch(e){a=!0,n=e}finally{try{!r&&l.return&&l.return()}finally{if(a)throw n}}}),o}return a(t,e),s(t,[{key:"update",value:function(){if(o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"update",this).call(this),(!this.data.meta||!this.data.meta.spawn)&&this.mesh.position.distanceTo(u.get("player").mesh.position)>250){var e=new c.Vec3;e.x=Math.interval(u.get("player").mesh.position.x-200,u.get("player").mesh.position.x+200),e.y=20,e.z=Math.interval(u.get("player").mesh.position.x-200,u.get("player").mesh.position.x+200);var i=new l.Raycaster(new l.Vector3(e.x,e.y,e.z),new l.Vector3(0,-1,0)),r=i.intersectObjects(u.get("scene").children,!0);if(r.length>0){var a=r[0].point;this.body.position.set(a.x,a.y+3,a.z)}else this.body.position.set(e.x,e.y,e.z)}}}]),t}(m),t.NPC=function(e){function t(e,a){n(this,t);var o=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,new l.Object3D,new c.Body,a)),s=i(14);if(!s[e])throw new Error("Error: cannot find NPC with id of "+e);var h=s[e];o.data=h,o.inv=h.inv;for(var p in h.stats)o[p]=h.stats[p];(new l.ObjectLoader).load("/assets/3d/"+h.path+".json",function(e){e.scale.set(2,2,2);var t=new c.Body({mass:5});t.addShape(new c.Sphere(.75));var i=void 0;if(i=new c.Vec3(a.pos.x||10,a.pos.y||20,a.pos.z||10),h.meta&&h.meta.spawn){var r=h.meta.spawn;i=6==r.length?new c.Vec3(Math.interval(r[0],r[1]),Math.interval(r[2],r[3]),Math.interval(r[4],r[5])):new c.Vec3(r[0],r[1],r[2])}t.position.set(i.x,i.y,i.z),t.linearDamping=.9,o.mesh=e,u.get("scene").add(o.mesh),o.body=t,u.get("world").add(o.body)}),o.addEventListener("newTarget",function(e){o.hasChosenTarget=o.hasChosenTarget||!1,o.hasSpokenInteract=o.hasSpokenInteract||!1,o.hasChosenTarget||(o.target=null),o.sounds[0]=null}),o.addEventListener("interact",function(){var e=0,t=!0,i=!1,r=void 0;try{for(var a,n=u.get("player").inv[Symbol.iterator]();!(t=(a=n.next()).done);t=!0)"gelatin"==a.value.id&&e++}catch(e){i=!0,r=e}finally{try{!t&&n.return&&n.return()}finally{if(i)throw r}}if(e<5){var s=document.createElement("audio");s.src="/assets/sfx/wicket-request.mp3",s.addEventListener("ended",function(){new Audio("/assets/sfx/wicket-tutorial-inventory.mp3").play()}),s.play()}else o.hasChosenTarget=!0,o.target=u.get("player"),new Audio("/assets/sfx/wicket-thanks.mp3").play()});var d=u.get("events").subscribe("system.pointerlock.enter",function(){var e=document.createElement("audio");e.src="/assets/sfx/wicket-help.mp3",e.addEventListener("ended",function(){var e=document.createElement("audio");e.src="/assets/sfx/wicket-tutorial-look.mp3",e.addEventListener("ended",function(){var e=u.get("events").subscribe("player.look",function(){var t=document.createElement("audio");t.src="/assets/sfx/wicket-success.mp3",t.addEventListener("ended",function(){var t=document.createElement("audio");t.src="/assets/sfx/wicket-tutorial-move.mp3",t.addEventListener("ended",function(){var t=u.get("events").subscribe("player.move",function(){var e=document.createElement("audio");e.src="/assets/sfx/wicket-success.mp3",e.addEventListener("ended",function(){var e=document.createElement("audio");e.src="/assets/sfx/wicket-tutorial-attack.mp3",e.addEventListener("ended",function(){var e=u.get("events").subscribe("system.click",function(){var t=document.createElement("audio");t.src="/assets/sfx/wicket-success.mp3",t.addEventListener("ended",function(){var e=document.createElement("audio");e.src="/assets/sfx/wicket-help-2.mp3",e.addEventListener("ended",function(){new Audio("/assets/sfx/wicket-tutorial-interact.mp3").play()}),e.play()}),t.play(),e.unsubscribe()})}),e.play()}),e.play(),t.unsubscribe()});e.unsubscribe()}),t.play()}),t.play(),e.unsubscribe()})}),e.play()}),e.play(),d.unsubscribe()});return o}return a(t,e),t}(m),t.Player=function(e){function t(){n(this,t);var e=new c.Sphere(1.3),i=new c.Body({mass:5});i.addShape(e),i.addEventListener("collide",function(e){var t=e.contact,r=new c.Vec3(0,1,0),a=new c.Vec3;t.bi.id==i.id?t.ni.negate(a):a.copy(t.ni),a.dot(r)>.5&&i.velocity.y<=-30&&(h.hp+=Math.floor(i.velocity.y/5))});var a=new l.Raycaster(new l.Vector3(0,40,0),new l.Vector3(0,-1,0)),o=a.intersectObjects(u.get("scene").children,!0);if(o.length>0){var s=o[0].point;i.position.set(s.x,s.y,s.z)}else i.position.set(200,2,0);var h=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"player",new l.Object3D,i));return h.poisons=[],h.lvl=1,h.xp=0,h.hp=100,h.hpMax=100,h.stm=100,h.stmMax=100,h.mp=100,h.mpMax=100,h.spd=.5,h.dmg=1,h}return a(t,e),s(t,[{key:"update",value:function(e){o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"update",this).call(this,e),h("#hp").html(this.hp+"/"+this.hpMax+" hp"),this.body.velocity.x*=.925,this.body.velocity.z*=.925}},{key:"damage",value:function(e){o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"damage",this).call(this,e),h("#vignette").fadeIn(550).fadeOut(550)}}]),t}(d)},function(e,t,i){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),n=i(0),o=i(3),s=function(){function e(t,i){r(this,e),o("#gui-title").text(t),o("#gui-content").html(i),this.show(),document.exitPointerLock()}return a(e,[{key:"show",value:function(){o("#gui").fadeIn(400)}},{key:"hide",value:function(){o("#gui").fadeOut(400)}}]),e}();t.default=s;var l=t.Menu=function e(){r(this,e);var t=o("<div>").attr("id","menu");o("<h3>").attr("id","menu-levels").html("Character").click(function(){return new c}).appendTo(t),o("<h3>").attr("id","menu-magic").html("Magic").click(function(){return new h}).appendTo(t),o("<h3>").attr("id","menu-inv").html("Inventory").click(function(){return new u}).appendTo(t),o("<h3>").attr("id","menu-options").html("Options").appendTo(t),o("<div>").attr("id","menu-cross").appendTo(t),new s("Menu",t)},c=t.Character=function e(){r(this,e),new s("Menu","<p>TODO</p>")},u=t.Inventory=function e(){r(this,e);var t=n.get("player").inv,i=o("<div>"),a=!0,l=!1,c=void 0;try{for(var u,h=t[Symbol.iterator]();!(a=(u=h.next()).done);a=!0)!function(){var e=u.value;!function(){o("<img>").attr("src",e.path).attr("title",e.name).attr("width",50).data("item",e).appendTo(i)}()}()}catch(e){l=!0,c=e}finally{try{!a&&h.return&&h.return()}finally{if(l)throw c}}i.on("click","img",function(){var e=o(this).data("item");if(o(this).hide(),n.get("player").inv.splice(n.get("player").inv.indexOf(e),1),"poison"==e.type)n.get("player").poisons.push(e),Materialize.toast("Your blade is now poisoned!",700);else if(e.effects)for(var t in o(this).data("item").effects)n.get("player")[t]+=e.effects[t]}),new s("Inventory",i)},h=t.Magic=function e(){r(this,e),new s("Menu","<p>TODO</p>")};t.HUD=function(){function e(){r(this,e),this.canvas=document.getElementById("hud-canvas"),this.canvas.setAttribute("width",.7*window.innerWidth),this.ctx=this.canvas.getContext("2d"),this.centerX=this.canvas.width/2,this.centerY=this.canvas.height/2,this.radius=40,this.radiusSmall=30,n.get("events").subscribe("system.update",this.draw.bind(this))}return a(e,[{key:"draw",value:function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(this.centerX-this.radiusSmall-15,this.canvas.height-this.radiusSmall-15,this.radiusSmall,0,2*Math.PI,!1),this.ctx.clip(),this.ctx.fillStyle="#000080",this.ctx.fillRect(this.centerX-2*this.radiusSmall-15,this.canvas.height-15,2*this.radiusSmall,-n.get("player").mp/n.get("player").mpMax*this.radiusSmall*2),this.ctx.restore(),this.ctx.beginPath(),this.ctx.arc(this.centerX-this.radiusSmall-15,this.canvas.height-this.radiusSmall-15,this.radiusSmall,0,2*Math.PI,!1),this.ctx.lineWidth=4,this.ctx.strokeStyle="#000000",this.ctx.stroke(),this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(this.centerX+this.radiusSmall+15,this.canvas.height-this.radiusSmall-15,this.radiusSmall,0,2*Math.PI,!1),this.ctx.clip(),this.ctx.fillStyle="#006400",this.ctx.fillRect(this.centerX+15,this.canvas.height-15,2*this.radiusSmall,-n.get("player").stm/n.get("player").stmMax*this.radiusSmall*2),this.ctx.restore(),this.ctx.beginPath(),this.ctx.arc(this.centerX+this.radiusSmall+15,this.canvas.height-this.radiusSmall-15,this.radiusSmall,0,2*Math.PI,!1),this.ctx.lineWidth=4,this.ctx.strokeStyle="#000000",this.ctx.stroke(),this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(this.centerX,this.canvas.height-this.radius-5,this.radius,0,2*Math.PI,!1),this.ctx.clip(),this.ctx.fillStyle="#cc0000",this.ctx.fillRect(this.centerX-this.radius,this.canvas.height-5,2*this.radius,-n.get("player").hp/n.get("player").hpMax*this.radius*2),this.ctx.restore(),this.ctx.beginPath(),this.ctx.arc(this.centerX,this.canvas.height-this.radius-5,this.radius,0,2*Math.PI,!1),this.ctx.lineWidth=6,this.ctx.strokeStyle="#000000",this.ctx.stroke();var e=this.ctx.createLinearGradient(0,0,n.get("player").xp/n.get("player").xpMax*this.canvas.width,0);e.addColorStop(0,"darkgreen"),e.addColorStop(.75,"darkgreen"),e.addColorStop(.95,"lime"),e.addColorStop(1,"lime"),this.ctx.fillStyle=e,this.ctx.fillRect(0,this.canvas.height-10,n.get("player").xp/n.get("player").xpMax*this.canvas.width,10),this.ctx.fillStyle="black",this.ctx.textAlign="center",this.ctx.fillText((n.get("player").hp>0?Math.floor(n.get("player").hp):0)+" HP",this.centerX,this.canvas.height-this.radius)}}]),e}();window.addEventListener("keypress",function(e){80!=e.keyCode&&112!=e.keyCode||new l}),o(document).keyup(function(e){"escape"==e.key.toLowerCase()&&o("#pause").show()})},function(e,t){e.exports={gelatin:{name:"Gelatin",id:"gelatin",desc:"Like jello, but not edible.",path:"/assets/icons/gelatin.png",weight:1,value:3,effects:{hp:-1}},gelball:{name:"Ball of Gel",id:"gelball",desc:"Compressed gelatin, has distinctive healing properties.",path:"/assets/icons/slow-blob.png",weight:3,value:3,effects:{hp:5}},hpostionsm:{name:"Small Draught of Health",id:"hpotionsm",desc:"A small healing potion for all your small healing needs.",path:"/assets/icons/health-potion.png",effects:{hp:5}},hpostionmd:{name:"Average Draught of Health",id:"hpotionmd",desc:"A slightly bigger vial of liquid health, tastes slightly of toenail fungus.",path:"/assets/icons/health-potion.png",effects:{hp:10}},hpostionlg:{name:"Large Draught of Health",id:"hpotionlg",desc:"Capable of healing almost all wounds, the toe fungus taste is undeniable in this potion.",path:"/assets/icons/health-potion.png",effects:{hp:15}},spostionsm:{name:"Small Draught of Stamina",id:"spotionsm",desc:"Restores a small amount of stamina with an invigorating serum and a hint of lemon.",path:"/assets/icons/stamina-potion.png",effects:{stm:5}},spostionmd:{name:"Medium Draught of Stamina",id:"spotionmd",desc:"Restores a moderate amount of stamina with an even more invigorating serum and a dash of... lime?",path:"/assets/icons/stamina-potion.png",effects:{stm:10}},spostionlg:{name:"Large Draught of Stamina",id:"spotionlg",desc:"A very invigorating potion which restores a lot of stamina but has a rather odd taste.",path:"/assets/icons/stamina-potion.png",effects:{stm:15}},mpostionsm:{name:"Small Vial of Magic",id:"mpotionsm",desc:"This potion glows faintly when exposed to light.",path:"/assets/icons/mana-potion.png",effects:{mp:5}},mpostionmd:{name:"Average Vial of Magic",id:"mpotionmd",desc:"'Wow!' -- Man after drinking this",path:"/assets/icons/mana-potion.png",effects:{mp:10}},mpostionlg:{name:"Large Vial of Magic",id:"mpotionlg",desc:"Feel the magic coursing through your veins as you sip on this delux magical vial.",path:"/assets/icons/mana-potion.png",effects:{mp:15}},whpoison:{name:"Weak Health Poison",id:"whpoison",desc:"This poison has no description; simply because it is poisonous.",type:"poison",path:"/assets/icons/health-poison.png",effects:{hp:-5}},hsafgpoison:{name:"Hella Strong As Fuck God Poison",id:"hsafgpoison",desc:"This poison has no description; simply because it is poisonous.",type:"poison",path:"/assets/icons/health-poison.png",effects:{hp:-1e11,mp:-1e11,stm:-1e11}}}},function(e,t,i){"use strict";var r=i(5),a=i(4).NPC;new r.HUD,window.onerror=alert,window.Grove.version="1.3.7",window.Grove.globals=i(0),Math.interval=function(e,t){return Math.floor(Math.random()*(t-e+1)+e)},Array.prototype.has=function(e){return this.indexOf(e)>-1};window.wicket=new a("wicket",{pos:{},sounds:["wicket.mp3",null,"wicket-hurt.mp3","wicket-hurt.mp3"]});i(15)(),i(16)(),i(21)(),i(22),i(23),i(5)},,,,,,function(e,t){e.exports={slime:{name:"Slime",path:"slime/slime",id:"slime",stats:{hp:5,hpMax:5,dmg:5,spd:7},hostility:[["wicket","player"],["slime","slime.red","slime.blue"],[]],inv:[{id:"gelatin",min:1,max:3}],mesh:[{name:"outer",transparent:!0,opacity:.3}]},"slime.red":{name:"Red Slime",path:"slime/slime",id:"slime.red",stats:{hp:10,hpMax:10,dmg:15,spd:7},hostility:[["wicket","player"],["slime","slime.red","slime.blue"],[]],inv:[{id:"gelatin",min:1,max:2}],meta:{spawn:[-500,200,250,300,310,390]},mesh:[{name:"outer",transparent:!0,opacity:.3,color:16711680},{name:"inner",color:16711680}]},"slime.blue":{name:"Blue Slime",path:"slime/slime",id:"slime.blue",stats:{hp:3,hpMax:3,dmg:25,spd:25},hostility:[["wicket","player"],["slime","slime.red","slime.blue"],[]],inv:[{id:"gelball",min:1,max:2}],mesh:[{name:"outer",transparent:!0,opacity:.3,color:255},{name:"inner",color:255}]}}},function(e,t){e.exports={wicket:{name:"Wicket",id:"wicket",path:"wicket/wicket",stats:{hp:300,hpMax:300,spd:20,dmg:15},hostility:[[],["player"],[]],meta:{spawn:[115,32,-30],sounds:["wicket.mp3","silence.wav","wicket-hurt.mp3","silence.wav"]}},bartholomew:{name:"Bartholomew",id:"bartholomew",path:"bartholomew/bartholomew",stats:{hp:100,hpMax:100,spd:12,dmg:7}}}},function(e,t,i){"use strict";var r=i(4),a=i(2),n=(i(1),i(0)),o=n.get("world");e.exports=function(){o.quatNormalizeSkip=0,o.quatNormalizeFast=!1;var e=new a.GSSolver;o.defaultContactMaterial.contactEquationStiffness=1e9,o.defaultContactMaterial.contactEquationRelaxation=4,e.iterations=7,e.tolerance=.1;o.solver=new a.SplitSolver(e),o.gravity.set(0,-20,0),o.broadphase=new a.NaiveBroadphase;var t=new a.Material("slipperyMaterial"),i=new a.ContactMaterial(t,t,0,.3);o.addContactMaterial(i),n.set("player",new r.Player)}},function(e,t,i){"use strict";function r(){o.get("camera").aspect=window.innerWidth/window.innerHeight,o.get("camera").updateProjectionMatrix(),s.setSize(window.innerWidth,window.innerHeight),console.log("Window resized to "+window.innerWidth+", "+window.innerHeight)}var a=i(3),n=i(1),o=(i(2),i(0)),s=o.get("renderer"),l=o.get("scene");e.exports=function(){var e=i(17);n.DefaultLoadingManager.onProgress=function(e,t,i){console.log("Loading "+e+" ("+t+"/"+i+")"),a("#loaded").text(Math.floor(t/i*100)+"% - v."+window.Grove.version)},n.DefaultLoadingManager.onLoad=function(){console.log("Loading complete"),a("#instructions").has("h4").length||a("#instructions").html("\n        <h4>"+e[Math.floor(Math.random()*e.length)]+"</h4>\n        <button class='play-btn btn waves-effect waves-light light-green z-depth-3'>Play</button>\n        ").addClass("pntrlk")},n.DefaultLoadingManager.onError=function(e){console.error("Error loading "+e)},l.fog=new n.FogExp2(16777215,.005);var t=i(18).DayNight,c=new t.SunSphere;l.add(c.object3d);var u=new t.Skydom;l.add(u.object3d);var h=new t.SunLight;l.add(h.object3d);var p=1/6*Math.PI*2,d=new n.AmbientLight(2236962);l.add(d),o.get("events").subscribe("system.update",function(e){o.get("controls").enabled&&(p+=1e-5*Math.PI*2,c.update(p),u.update(p),h.update(p))});var m=i(19);o.set("controls",new m(o.get("camera"),o.get("player").body)),l.add(o.get("controls").getObject()),i(20)(o.get("controls")),(new n.ObjectLoader).load("/assets/3d/skjar-isles/skjar-isles.json",function(e){l.add(e),e.castShadow=!0,e.receiveShadow=!0,e.traverse(function(e){e.castShadow=!0,e.receiveShadow=!0,e instanceof n.Mesh&&!/NP/gi.test(e.name)?(console.log("Loading "+e.name),o.get("load")(e)):"NP_Ocean"==e.name&&(e.material.transparent=!0,e.material.opacity=.9)})}),s.shadowMap.enabled=!0,s.shadowMapSoft=!0,s.setSize(window.innerWidth,window.innerHeight),s.setClearColor(l.fog.color,1),document.body.appendChild(s.domElement),window.addEventListener("resize",r,!1)}},function(e,t){e.exports=["While the island's mountains may be fun to climb, keep a look out; they are teeming with some of The Grove's more formiddable creatures.","OOOOO OOOOO OOOOO - Hunter Sokolis, time unknown","Fall damage is a thing now.","A slime's power depends on its color. Green slimes are easy to beat, whereas red slimes are harder.","Please tolerate our crappy graphics","Can you find Hunter's hidden characters?","There will be an update to this game eventually. Keyword is eventually.","Can you find the mysterious ButtBook?","How many slimes can you kill?","Beware the foul-smelling train!","Did you know Wicket is a candle?","<span class='rune'>welcome young traveller</span> - ancient Grove folklore"]},function(e,t,i){"use strict";var r=i(1),a=e.exports=a||{};a.DayNight={},a.DayNight.baseURL="../",a.DayNight.currentPhase=function(e){return Math.sin(e)>Math.sin(0)?"day":Math.sin(e)>Math.sin(-Math.PI/6)?"twilight":"night"},a.DayNight.StarField=function(){var e=r.ImageUtils.loadTexture(a.DayNight.baseURL+"images/galaxy_starfield.png"),t=new r.MeshBasicMaterial({map:e,side:r.BackSide,color:8421504}),i=new r.SphereGeometry(4500,32,32),n=new r.Mesh(i,t);this.object3d=n,this.update=function(e){var i=a.DayNight.currentPhase(e);if("day"===i)n.visible=!1;else if("twilight"===i)n.visible=!1;else{n.visible=!0,n.rotation.y=e/5;var r=Math.abs(Math.sin(e));t.color.setRGB(r,r,r)}}},a.DayNight.SunLight=function(){var e=new r.DirectionalLight(16777215,1);this.object3d=e,this.update=function(t){e.position.x=0,e.position.y=9e4*Math.sin(t),e.position.z=9e4*Math.cos(t);var i=a.DayNight.currentPhase(t);"day"===i?e.color.set("rgb(255,"+(Math.floor(200*Math.sin(t))+55)+","+Math.floor(200*Math.sin(t))+")"):"twilight"===i?(e.intensity=1,e.color.set("rgb("+(255-Math.floor(510*Math.sin(t)*-1))+","+(55-Math.floor(110*Math.sin(t)*-1))+",0)")):e.intensity=1}},a.DayNight.SunSphere=function(){var e=new r.SphereGeometry(20,30,30),t=new r.MeshBasicMaterial({color:16711680}),i=new r.Mesh(e,t);this.object3d=i,this.update=function(e){i.position.x=0,i.position.y=400*Math.sin(e),i.position.z=400*Math.cos(e);var t=a.DayNight.currentPhase(e);"day"===t?i.material.color.set("rgb(255,"+(Math.floor(200*Math.sin(e))+55)+","+(Math.floor(200*Math.sin(e))+5)+")"):"twilight"===t&&i.material.color.set("rgb(255,55,5)")}},a.DayNight.Skydom=function(){var e=new r.SphereGeometry(4500,32,15),t=a.DayNight.Skydom.Shader,i=r.UniformsUtils.clone(t.uniforms),n=new r.ShaderMaterial({vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,uniforms:i,side:r.BackSide}),o=new r.Mesh(e,n);this.object3d=o,this.update=function(e){var t=a.DayNight.currentPhase(e);"day"===t?(i.topColor.value.set("rgb(0,120,255)"),i.bottomColor.value.set("rgb(255,"+(Math.floor(200*Math.sin(e))+55)+","+Math.floor(200*Math.sin(e))+")")):"twilight"===t?(i.topColor.value.set("rgb(0,"+(120-Math.floor(240*Math.sin(e)*-1))+","+(255-Math.floor(510*Math.sin(e)*-1))+")"),i.bottomColor.value.set("rgb("+(255-Math.floor(510*Math.sin(e)*-1))+","+(55-Math.floor(110*Math.sin(e)*-1))+",0)")):(i.topColor.value.set("black"),i.bottomColor.value.set("black"))}},a.DayNight.Skydom.Shader={uniforms:{topColor:{type:"c",value:(new r.Color).setHSL(.6,1,.75)},bottomColor:{type:"c",value:new r.Color(16777215)},offset:{type:"f",value:400},exponent:{type:"f",value:.6}},vertexShader:["varying vec3 vWorldPosition;","void main() {","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tvWorldPosition = worldPosition.xyz;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec3 topColor;","uniform vec3 bottomColor;","uniform float offset;","uniform float exponent;","varying vec3 vWorldPosition;","void main() {","\tfloat h = normalize( vWorldPosition + offset ).y;","\tgl_FragColor = vec4( mix( bottomColor, topColor, max( pow( h, exponent ), 0.0 ) ), 1.0 );","}"].join("\n")}},function(e,t,i){"use strict";var r=i(1),a=i(2),n=i(0);e.exports=function(e,t){var i=new Audio("/assets/sfx/leaves01.ogg"),o=this,s=new r.Object3D;s.add(e),e.position.y+=1;var l=new r.Object3D;l.position.y=2,l.add(s);var c=new r.Quaternion,u=!1,h=!1,p=!1,d=!1,m=!1,f=!1,y=new a.Vec3,g=new a.Vec3(0,1,0);t.addEventListener("collide",function(e){var i=e.contact;i.bi.id==t.id?i.ni.negate(y):y.copy(i.ni),y.dot(g)>.5&&(m=!0)});var v=t.velocity,b=Math.PI/2,x=function(e){if(!1!==o.enabled){var t=e.movementX||e.mozMovementX||e.webkitMovementX||0,i=e.movementY||e.mozMovementY||e.webkitMovementY||0;l.rotation.y-=.002*t,s.rotation.x-=.002*i,s.rotation.x=Math.max(-b,Math.min(b,s.rotation.x)),n.get("events").publish("player.look",{pitch:s.rotation,yaw:l.rotation})}},w=function(e){switch(e.keyCode){case 38:case 87:u=!0,n.get("events").publish("player.move",{});break;case 37:case 65:p=!0,n.get("events").publish("player.move",{});break;case 40:case 83:h=!0,n.get("events").publish("player.move",{});break;case 39:case 68:d=!0,n.get("events").publish("player.move",{});break;case 32:!0===m&&(v.y=10,n.get("events").publish("player.jump",{})),m=!1;break;case 16:f=!0}},A=function(e){switch(e.keyCode){case 38:case 87:u=!1;break;case 37:case 65:p=!1;break;case 40:case 83:h=!1;break;case 39:case 68:d=!1;break;case 16:f=!1}};document.addEventListener("mousemove",x,!1),document.addEventListener("touchmove",x,!1),document.addEventListener("keydown",w,!1),document.addEventListener("keyup",A,!1),this.enabled=!1,this.getObject=function(){return l},this.getDirection=function(e){e.set(0,0,-1),c.multiplyVector3(e)};var _=new r.Vector3,E=new r.Euler;this.update=function(e){if(!1!==o.enabled){e*=.1,_.set(0,0,0);var r=n.get("player").spd;f&&n.get("player").stm>0&&(r*=2,n.get("player").stm--,n.get("player").lastUsedStamina=Date.now()),u&&(_.z=-r*e),h&&(_.z=r*e),p&&(_.x=-r*e),d&&(_.x=r*e),E.y=l.rotation.y,E.order="XYZ",c.setFromEuler(E),_.applyQuaternion(c),v.x+=_.x,v.z+=_.z,(Math.abs(v.x)>4||Math.abs(v.z)>4)&&m&&(u||h||p||d)?i.play():u||h||p||d||!m||(v.x*=.675,v.z*=.675),l.position.copy(t.position)}}}},function(e,t,i){"use strict";var r=i(3),a=i(0);e.exports=function(e){var t=document.getElementById("blocker"),i=document.getElementById("instructions");if("pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document){var n=document.body,o=function(i){a.get("events").publish("system.pointerlock.enter",{}),document.pointerLockElement===n||document.mozPointerLockElement===n||document.webkitPointerLockElement===n?(e.enabled=!0,t.style.display="none"):e.enabled=!1},s=function(e){i.style.display=""};document.addEventListener("pointerlockchange",o,!1),document.addEventListener("mozpointerlockchange",o,!1),document.addEventListener("webkitpointerlockchange",o,!1),document.addEventListener("pointerlockerror",s,!1),document.addEventListener("mozpointerlockerror",s,!1),document.addEventListener("webkitpointerlockerror",s,!1),setInterval(function(){r(".pntrlk").click(function(e){if(i.style.display="none",n.requestPointerLock=n.requestPointerLock||n.mozRequestPointerLock||n.webkitRequestPointerLock,/Firefox/i.test(navigator.userAgent)){var t=function e(t){document.fullscreenElement!==n&&document.mozFullscreenElement!==n&&document.mozFullScreenElement!==n||(document.removeEventListener("fullscreenchange",e),document.removeEventListener("mozfullscreenchange",e),n.requestPointerLock())};document.addEventListener("fullscreenchange",t,!1),document.addEventListener("mozfullscreenchange",t,!1),n.requestFullscreen=n.requestFullscreen||n.mozRequestFullscreen||n.mozRequestFullScreen||n.webkitRequestFullscreen,n.requestFullscreen()}else n.requestPointerLock()})},500)}else i.innerHTML="Your browser doesn't seem to support Pointer Lock API"}},function(e,t,i){"use strict";var r=i(4),a=i(0),n=i(3),o=i(1);i(2);e.exports=function e(t){requestAnimationFrame(e),a.get("controls").enabled&&a.get("world").step(1/60);var i=!0,s=!1,l=void 0;try{for(var c,u=a.get("entities")[Symbol.iterator]();!(i=(c=u.next()).done);i=!0){c.value.update(t)}}catch(e){s=!0,l=e}finally{try{!i&&u.return&&u.return()}finally{if(s)throw l}}var h=!0,p=!1,d=void 0;try{for(var m,f=a.get("tweens")[Symbol.iterator]();!(h=(m=f.next()).done);h=!0){m.value.update(t)}}catch(e){p=!0,d=e}finally{try{!h&&f.return&&f.return()}finally{if(p)throw d}}if(a.get("entities").length<30){var y="slime";Math.random()<.25?y="slime.red":Math.random()<.05&&(y="slime.blue");new r.Creature(y,{pos:{x:Math.interval(a.get("player").mesh.position.x-200,a.get("player").mesh.position.x+200),y:30,z:Math.interval(a.get("player").mesh.position.z-200,a.get("player").mesh.position.z+200),override:!1},sounds:[null,"slime-attack.wav","slime-hurt.wav","slime-die.wav"]})}a.get("player").body.position.y<-100?a.get("player").body.position.set(0,15,0):a.get("player").body.position.y<-20?n("#overlay").css("background","blue").css("opacity",.5).show():n("#overlay").hide(),a.get("controls").update(Date.now()-a.get("time")),a.get("renderer").render(a.get("scene"),a.get("camera")),a.set("time",Date.now()),a.set("tick",a.get("tick")+1);var g=new o.Raycaster;g.set(a.get("camera").getWorldPosition(),a.get("camera").getWorldDirection());var v=!0,b=!1,x=void 0;try{for(var w,A=a.get("entities")[Symbol.iterator]();!(v=(w=A.next()).done);v=!0){var _=w.value;g.intersectObjects(_.mesh.children,!0).length?(_.data&&n("#label").html(_.data.name+" ("+Math.round(_.hp)+"/"+_.hpMax+")"),n("#crosshair").attr("src","/assets/img/crosshair/crosshair-enemy.png")):a.get("tick")%30==0&&(n("#label").html(""),n("#crosshair").attr("src","/assets/img/crosshair/crosshair.png"))}}catch(e){b=!0,x=e}finally{try{!v&&A.return&&A.return()}finally{if(b)throw x}}a.get("events").publish("system.update",{delta:t})}},function(e,t,i){"use strict";for(var r=i(0),a=r.get("player"),n=i(6),o=0;o<0;o++)a.inv.push({name:"Small Draught of Health",id:"hpotionsm",path:"/assets/icons/health-potion.png",desc:"cuz fuck it",effects:{hp:5}});a.inv.push(n.whpoison)},function(e,t,i){"use strict";function r(e){if(c.get("controls").enabled){var t=new s.Raycaster;if(t.set(c.get("camera").getWorldPosition(),c.get("camera").getWorldDirection()),h&&Date.now()-c.get("player").lastAttacked>800){c.get("events").publish("player.attack",{});var i=new l.Tween(h.rotation).to({x:[-Math.PI/2,0]},800).onStart(function(){f.play()}).start();c.get("tweens").push(i),c.get("player").lastAttacked=Date.now();var r=!0,a=!1,n=void 0;try{for(var o,u=c.get("entities")[Symbol.iterator]();!(r=(o=u.next()).done);r=!0){var p=o.value;if(t.intersectObjects(p.mesh.children,!0).length&&c.get("player").mesh.position.distanceTo(p.mesh.position)<5){p.callEvent("click"),c.get("player").attack(p);for(var d=0;d<c.get("player").poisons.length;d++){var m=c.get("player").poisons[d];console.log(m);for(var y in m.effects)console.log(m.effects[y]),p[y]+=m.effects[y],p.hp<=0&&p.kill(c.get("player"));c.get("player").poisons.splice(d,1)}}}}catch(e){a=!0,n=e}finally{try{!r&&u.return&&u.return()}finally{if(a)throw n}}}}}function a(e){"keydown"==e.type||"mousedown"==e.type&&!m?(c.get("camera").add(p.particleGroup.mesh),p.emitter.particleCount=1e3,d=!0):(c.get("camera").remove(p.particleGroup.mesh),d=!1)}function n(e){var t=new s.Raycaster;t.set(c.get("camera").getWorldPosition(),c.get("camera").getWorldDirection());var i=!0,r=!1,a=void 0;try{for(var n,o=c.get("entities")[Symbol.iterator]();!(i=(n=o.next()).done);i=!0){var l=n.value;t.intersectObjects(l.mesh.children,!0).length&&l.callEvent("interact")}}catch(e){r=!0,a=e}finally{try{!i&&o.return&&o.return()}finally{if(r)throw a}}}var o=i(24),s=i(1),l=i(26),c=i(0),u=i(3),h=void 0,p=new o.Fire,d=!1,m=!1,f=new Audio("/assets/sfx/sword.mp3");f.volume=.1,c.get("events").subscribe("system.update",function(){if(p.particleGroup.tick(.015),d&&c.get("player").mp>0){c.get("player").mp-=.5;var e=new s.Raycaster;e.set(c.get("camera").getWorldPosition(),c.get("camera").getWorldDirection());var t=!0,i=!1,r=void 0;try{for(var a,n=c.get("entities")[Symbol.iterator]();!(t=(a=n.next()).done);t=!0){var o=a.value;e.intersectObjects(o.mesh.children,!0).length&&c.get("player").mesh.position.distanceTo(o.mesh.position)<10&&o.damage(.2,c.get("player"))}}catch(e){i=!0,r=e}finally{try{!t&&n.return&&n.return()}finally{if(i)throw r}}c.get("player").lastUsedMagic=Date.now()}else p.emitter.particleCount=0,c.get("camera").remove(p.particleGroup.mesh),d=!1,m=!0,setTimeout(function(){return m=!1},500)}),u(window).on("mousedown mouseup",function(e){c.get("controls").enabled&&(c.get("events").publish("system.click",e),2==e.which||4==e.button?n(e):1==e.which?r(e):3==e.which&&a(e))}),u(window).on("keydown keyup",function(e){c.get("controls").enabled&&(!(69==e.keyCode)||n(e),!(81==e.keyCode)||r(e),!(82==e.keyCode)||a(e))}),(new s.ObjectLoader).load("/assets/3d/sword/sword.json",function(e){c.get("camera").add(e),e.scale.set(.1,.1,.1),e.position.x++,e.position.y-=1.2,e.position.z-=1.25,h=e})},function(e,t,i){"use strict";function r(){var e=new a.Group({texture:{value:n.ImageUtils.loadTexture("/assets/img/glow.png")}}),t=new a.Emitter({maxAge:{value:1.5},position:{value:new n.Vector3(-.7,-.72,-.94),spread:new n.Vector3(0,0,0)},acceleration:{value:new n.Vector3(0,0,0),spread:new n.Vector3(.5,.5,0)},velocity:{value:new n.Vector3(0,0,-5),spread:new n.Vector3(-.5,-.5,.5)},direction:1,color:{value:[new n.Color("purple"),new n.Color("orange"),new n.Color("red"),new n.Color("black")]},size:{value:.3},particleCount:1e3});return e.addEmitter(t),{particleGroup:e,emitter:t}}Object.defineProperty(t,"__esModule",{value:!0}),t.Fire=r;var a=i(25),n=i(1);i(0)},function(e,t,i){"use strict";var r,a,n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=i(1),s={distributions:{BOX:1,SPHERE:2,DISC:3},valueOverLifetimeLength:4};r=s,void 0!==(a="function"==typeof r?r.call(t,i,t,e):r)&&(e.exports=a),s.TypedArrayHelper=function(e,t,i,r){this.componentSize=i||1,this.size=t||1,this.TypedArrayConstructor=e||Float32Array,this.array=new e(t*this.componentSize),this.indexOffset=r||0},s.TypedArrayHelper.constructor=s.TypedArrayHelper,s.TypedArrayHelper.prototype.setSize=function(e,t){var i=this.array.length;return t||(e*=this.componentSize),i>e?this.shrink(e):e>i?this.grow(e):void console.info("TypedArray is already of size:",e+".","Will not resize.")},s.TypedArrayHelper.prototype.shrink=function(e){return this.array=this.array.subarray(0,e),this.size=e,this},s.TypedArrayHelper.prototype.grow=function(e){var t=this.array,i=new this.TypedArrayConstructor(e);return i.set(t),this.array=i,this.size=e,this},s.TypedArrayHelper.prototype.splice=function(e,t){e*=this.componentSize,t*=this.componentSize;for(var i=[],r=this.array,a=r.length,n=0;a>n;++n)(e>n||n>=t)&&i.push(r[n]);return this.setFromArray(0,i),this},s.TypedArrayHelper.prototype.setFromArray=function(e,t){var i=t.length,r=e+i;return r>this.array.length?this.grow(r):r<this.array.length&&this.shrink(r),this.array.set(t,this.indexOffset+e),this},s.TypedArrayHelper.prototype.setVec2=function(e,t){return this.setVec2Components(e,t.x,t.y)},s.TypedArrayHelper.prototype.setVec2Components=function(e,t,i){var r=this.array,a=this.indexOffset+e*this.componentSize;return r[a]=t,r[a+1]=i,this},s.TypedArrayHelper.prototype.setVec3=function(e,t){return this.setVec3Components(e,t.x,t.y,t.z)},s.TypedArrayHelper.prototype.setVec3Components=function(e,t,i,r){var a=this.array,n=this.indexOffset+e*this.componentSize;return a[n]=t,a[n+1]=i,a[n+2]=r,this},s.TypedArrayHelper.prototype.setVec4=function(e,t){return this.setVec4Components(e,t.x,t.y,t.z,t.w)},s.TypedArrayHelper.prototype.setVec4Components=function(e,t,i,r,a){var n=this.array,o=this.indexOffset+e*this.componentSize;return n[o]=t,n[o+1]=i,n[o+2]=r,n[o+3]=a,this},s.TypedArrayHelper.prototype.setMat3=function(e,t){return this.setFromArray(this.indexOffset+e*this.componentSize,t.elements)},s.TypedArrayHelper.prototype.setMat4=function(e,t){return this.setFromArray(this.indexOffset+e*this.componentSize,t.elements)},s.TypedArrayHelper.prototype.setColor=function(e,t){return this.setVec3Components(e,t.r,t.g,t.b)},s.TypedArrayHelper.prototype.setNumber=function(e,t){return this.array[this.indexOffset+e*this.componentSize]=t,this},s.TypedArrayHelper.prototype.getValueAtIndex=function(e){return this.array[this.indexOffset+e]},s.TypedArrayHelper.prototype.getComponentValueAtIndex=function(e){return this.array.subarray(this.indexOffset+e*this.componentSize)},s.ShaderAttribute=function(e,t,i){var r=s.ShaderAttribute.typeSizeMap;this.type="string"==typeof e&&r.hasOwnProperty(e)?e:"f",this.componentSize=r[this.type],this.arrayType=i||Float32Array,this.typedArray=null,this.bufferAttribute=null,this.dynamicBuffer=!!t,this.updateMin=0,this.updateMax=0},s.ShaderAttribute.constructor=s.ShaderAttribute,s.ShaderAttribute.typeSizeMap={f:1,v2:2,v3:3,v4:4,c:3,m3:9,m4:16},s.ShaderAttribute.prototype.setUpdateRange=function(e,t){this.updateMin=Math.min(e*this.componentSize,this.updateMin*this.componentSize),this.updateMax=Math.max(t*this.componentSize,this.updateMax*this.componentSize)},s.ShaderAttribute.prototype.flagUpdate=function(){var e=this.bufferAttribute,t=e.updateRange;t.offset=this.updateMin,t.count=Math.min(this.updateMax-this.updateMin+this.componentSize,this.typedArray.array.length),e.needsUpdate=!0},s.ShaderAttribute.prototype.resetUpdateRange=function(){this.updateMin=0,this.updateMax=0},s.ShaderAttribute.prototype.resetDynamic=function(){this.bufferAttribute.dynamic=this.dynamicBuffer},s.ShaderAttribute.prototype.splice=function(e,t){this.typedArray.splice(e,t),this.forceUpdateAll()},s.ShaderAttribute.prototype.forceUpdateAll=function(){this.bufferAttribute.array=this.typedArray.array,this.bufferAttribute.updateRange.offset=0,this.bufferAttribute.updateRange.count=-1,this.bufferAttribute.dynamic=!1,this.bufferAttribute.needsUpdate=!0},s.ShaderAttribute.prototype._ensureTypedArray=function(e){null!==this.typedArray&&this.typedArray.size===e*this.componentSize||(null!==this.typedArray&&this.typedArray.size!==e?this.typedArray.setSize(e):null===this.typedArray&&(this.typedArray=new s.TypedArrayHelper(this.arrayType,e,this.componentSize)))},s.ShaderAttribute.prototype._createBufferAttribute=function(e){return this._ensureTypedArray(e),null!==this.bufferAttribute?(this.bufferAttribute.array=this.typedArray.array,parseFloat(o.REVISION)>=81&&(this.bufferAttribute.count=this.bufferAttribute.array.length/this.bufferAttribute.itemSize),void(this.bufferAttribute.needsUpdate=!0)):(this.bufferAttribute=new o.BufferAttribute(this.typedArray.array,this.componentSize),void(this.bufferAttribute.dynamic=this.dynamicBuffer))},s.ShaderAttribute.prototype.getLength=function(){return null===this.typedArray?0:this.typedArray.array.length},s.shaderChunks={defines:["#define PACKED_COLOR_SIZE 256.0","#define PACKED_COLOR_DIVISOR 255.0"].join("\n"),uniforms:["uniform float deltaTime;","uniform float runTime;","uniform sampler2D texture;","uniform vec4 textureAnimation;","uniform float scale;"].join("\n"),attributes:["attribute vec4 acceleration;","attribute vec3 velocity;","attribute vec4 rotation;","attribute vec3 rotationCenter;","attribute vec4 params;","attribute vec4 size;","attribute vec4 angle;","attribute vec4 color;","attribute vec4 opacity;"].join("\n"),varyings:["varying vec4 vColor;","#ifdef SHOULD_ROTATE_TEXTURE","    varying float vAngle;","#endif","#ifdef SHOULD_CALCULATE_SPRITE","    varying vec4 vSpriteSheet;","#endif"].join("\n"),branchAvoidanceFunctions:["float when_gt(float x, float y) {","    return max(sign(x - y), 0.0);","}","float when_lt(float x, float y) {","    return min( max(1.0 - sign(x - y), 0.0), 1.0 );","}","float when_eq( float x, float y ) {","    return 1.0 - abs( sign( x - y ) );","}","float when_ge(float x, float y) {","  return 1.0 - when_lt(x, y);","}","float when_le(float x, float y) {","  return 1.0 - when_gt(x, y);","}","float and(float a, float b) {","    return a * b;","}","float or(float a, float b) {","    return min(a + b, 1.0);","}"].join("\n"),unpackColor:["vec3 unpackColor( in float hex ) {","   vec3 c = vec3( 0.0 );","   float r = mod( (hex / PACKED_COLOR_SIZE / PACKED_COLOR_SIZE), PACKED_COLOR_SIZE );","   float g = mod( (hex / PACKED_COLOR_SIZE), PACKED_COLOR_SIZE );","   float b = mod( hex, PACKED_COLOR_SIZE );","   c.r = r / PACKED_COLOR_DIVISOR;","   c.g = g / PACKED_COLOR_DIVISOR;","   c.b = b / PACKED_COLOR_DIVISOR;","   return c;","}"].join("\n"),unpackRotationAxis:["vec3 unpackRotationAxis( in float hex ) {","   vec3 c = vec3( 0.0 );","   float r = mod( (hex / PACKED_COLOR_SIZE / PACKED_COLOR_SIZE), PACKED_COLOR_SIZE );","   float g = mod( (hex / PACKED_COLOR_SIZE), PACKED_COLOR_SIZE );","   float b = mod( hex, PACKED_COLOR_SIZE );","   c.r = r / PACKED_COLOR_DIVISOR;","   c.g = g / PACKED_COLOR_DIVISOR;","   c.b = b / PACKED_COLOR_DIVISOR;","   c *= vec3( 2.0 );","   c -= vec3( 1.0 );","   return c;","}"].join("\n"),floatOverLifetime:["float getFloatOverLifetime( in float positionInTime, in vec4 attr ) {","    highp float value = 0.0;","    float deltaAge = positionInTime * float( VALUE_OVER_LIFETIME_LENGTH - 1 );","    float fIndex = 0.0;","    float shouldApplyValue = 0.0;","    value += attr[ 0 ] * when_eq( deltaAge, 0.0 );","","    for( int i = 0; i < VALUE_OVER_LIFETIME_LENGTH - 1; ++i ) {","       fIndex = float( i );","       shouldApplyValue = and( when_gt( deltaAge, fIndex ), when_le( deltaAge, fIndex + 1.0 ) );","       value += shouldApplyValue * mix( attr[ i ], attr[ i + 1 ], deltaAge - fIndex );","    }","","    return value;","}"].join("\n"),colorOverLifetime:["vec3 getColorOverLifetime( in float positionInTime, in vec3 color1, in vec3 color2, in vec3 color3, in vec3 color4 ) {","    vec3 value = vec3( 0.0 );","    value.x = getFloatOverLifetime( positionInTime, vec4( color1.x, color2.x, color3.x, color4.x ) );","    value.y = getFloatOverLifetime( positionInTime, vec4( color1.y, color2.y, color3.y, color4.y ) );","    value.z = getFloatOverLifetime( positionInTime, vec4( color1.z, color2.z, color3.z, color4.z ) );","    return value;","}"].join("\n"),paramFetchingFunctions:["float getAlive() {","   return params.x;","}","float getAge() {","   return params.y;","}","float getMaxAge() {","   return params.z;","}","float getWiggle() {","   return params.w;","}"].join("\n"),forceFetchingFunctions:["vec4 getPosition( in float age ) {","   return modelViewMatrix * vec4( position, 1.0 );","}","vec3 getVelocity( in float age ) {","   return velocity * age;","}","vec3 getAcceleration( in float age ) {","   return acceleration.xyz * age;","}"].join("\n"),rotationFunctions:["#ifdef SHOULD_ROTATE_PARTICLES","   mat4 getRotationMatrix( in vec3 axis, in float angle) {","       axis = normalize(axis);","       float s = sin(angle);","       float c = cos(angle);","       float oc = 1.0 - c;","","       return mat4(oc * axis.x * axis.x + c,           oc * axis.x * axis.y - axis.z * s,  oc * axis.z * axis.x + axis.y * s,  0.0,","                   oc * axis.x * axis.y + axis.z * s,  oc * axis.y * axis.y + c,           oc * axis.y * axis.z - axis.x * s,  0.0,","                   oc * axis.z * axis.x - axis.y * s,  oc * axis.y * axis.z + axis.x * s,  oc * axis.z * axis.z + c,           0.0,","                   0.0,                                0.0,                                0.0,                                1.0);","   }","","   vec3 getRotation( in vec3 pos, in float positionInTime ) {","      if( rotation.y == 0.0 ) {","           return pos;","      }","","      vec3 axis = unpackRotationAxis( rotation.x );","      vec3 center = rotationCenter;","      vec3 translated;","      mat4 rotationMatrix;","      float angle = 0.0;","      angle += when_eq( rotation.z, 0.0 ) * rotation.y;","      angle += when_gt( rotation.z, 0.0 ) * mix( 0.0, rotation.y, positionInTime );","      translated = rotationCenter - pos;","      rotationMatrix = getRotationMatrix( axis, angle );","      return center - vec3( rotationMatrix * vec4( translated, 0.0 ) );","   }","#endif"].join("\n"),rotateTexture:["    vec2 vUv = vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y );","","    #ifdef SHOULD_ROTATE_TEXTURE","       float x = gl_PointCoord.x - 0.5;","       float y = 1.0 - gl_PointCoord.y - 0.5;","       float c = cos( -vAngle );","       float s = sin( -vAngle );","       vUv = vec2( c * x + s * y + 0.5, c * y - s * x + 0.5 );","    #endif","","    #ifdef SHOULD_CALCULATE_SPRITE","        float framesX = vSpriteSheet.x;","        float framesY = vSpriteSheet.y;","        float columnNorm = vSpriteSheet.z;","        float rowNorm = vSpriteSheet.w;","        vUv.x = gl_PointCoord.x * framesX + columnNorm;","        vUv.y = 1.0 - (gl_PointCoord.y * framesY + rowNorm);","    #endif","","    vec4 rotatedTexture = texture2D( texture, vUv );"].join("\n")},s.shaders={vertex:[s.shaderChunks.defines,s.shaderChunks.uniforms,s.shaderChunks.attributes,s.shaderChunks.varyings,o.ShaderChunk.common,o.ShaderChunk.logdepthbuf_pars_vertex,o.ShaderChunk.fog_pars_vertex,s.shaderChunks.branchAvoidanceFunctions,s.shaderChunks.unpackColor,s.shaderChunks.unpackRotationAxis,s.shaderChunks.floatOverLifetime,s.shaderChunks.colorOverLifetime,s.shaderChunks.paramFetchingFunctions,s.shaderChunks.forceFetchingFunctions,s.shaderChunks.rotationFunctions,"void main() {","    highp float age = getAge();","    highp float alive = getAlive();","    highp float maxAge = getMaxAge();","    highp float positionInTime = (age / maxAge);","    highp float isAlive = when_gt( alive, 0.0 );","    #ifdef SHOULD_WIGGLE_PARTICLES","        float wiggleAmount = positionInTime * getWiggle();","        float wiggleSin = isAlive * sin( wiggleAmount );","        float wiggleCos = isAlive * cos( wiggleAmount );","    #endif","    vec3 vel = getVelocity( age );","    vec3 accel = getAcceleration( age );","    vec3 force = vec3( 0.0 );","    vec3 pos = vec3( position );","    float drag = 1.0 - (positionInTime * 0.5) * acceleration.w;","    force += vel;","    force *= drag;","    force += accel * age;","    pos += force;","    #ifdef SHOULD_WIGGLE_PARTICLES","        pos.x += wiggleSin;","        pos.y += wiggleCos;","        pos.z += wiggleSin;","    #endif","    #ifdef SHOULD_ROTATE_PARTICLES","        pos = getRotation( pos, positionInTime );","    #endif","    vec4 mvPosition = modelViewMatrix * vec4( pos, 1.0 );","    highp float pointSize = getFloatOverLifetime( positionInTime, size ) * isAlive;","    #ifdef HAS_PERSPECTIVE","        float perspective = scale / length( mvPosition.xyz );","    #else","        float perspective = 1.0;","    #endif","    float pointSizePerspective = pointSize * perspective;","    #ifdef COLORIZE","       vec3 c = isAlive * getColorOverLifetime(","           positionInTime,","           unpackColor( color.x ),","           unpackColor( color.y ),","           unpackColor( color.z ),","           unpackColor( color.w )","       );","    #else","       vec3 c = vec3(1.0);","    #endif","    float o = isAlive * getFloatOverLifetime( positionInTime, opacity );","    vColor = vec4( c, o );","    #ifdef SHOULD_ROTATE_TEXTURE","        vAngle = isAlive * getFloatOverLifetime( positionInTime, angle );","    #endif","    #ifdef SHOULD_CALCULATE_SPRITE","        float framesX = textureAnimation.x;","        float framesY = textureAnimation.y;","        float loopCount = textureAnimation.w;","        float totalFrames = textureAnimation.z;","        float frameNumber = mod( (positionInTime * loopCount) * totalFrames, totalFrames );","        float column = floor(mod( frameNumber, framesX ));","        float row = floor( (frameNumber - column) / framesX );","        float columnNorm = column / framesX;","        float rowNorm = row / framesY;","        vSpriteSheet.x = 1.0 / framesX;","        vSpriteSheet.y = 1.0 / framesY;","        vSpriteSheet.z = columnNorm;","        vSpriteSheet.w = rowNorm;","    #endif","    gl_PointSize = pointSizePerspective;","    gl_Position = projectionMatrix * mvPosition;",o.ShaderChunk.logdepthbuf_vertex,o.ShaderChunk.fog_vertex,"}"].join("\n"),fragment:[s.shaderChunks.uniforms,o.ShaderChunk.common,o.ShaderChunk.fog_pars_fragment,o.ShaderChunk.logdepthbuf_pars_fragment,s.shaderChunks.varyings,s.shaderChunks.branchAvoidanceFunctions,"void main() {","    vec3 outgoingLight = vColor.xyz;","    ","    #ifdef ALPHATEST","       if ( vColor.w < float(ALPHATEST) ) discard;","    #endif",s.shaderChunks.rotateTexture,o.ShaderChunk.logdepthbuf_fragment,"    outgoingLight = vColor.xyz * rotatedTexture.xyz;","    gl_FragColor = vec4( outgoingLight.xyz, rotatedTexture.w * vColor.w );",o.ShaderChunk.fog_fragment,"}"].join("\n")},s.utils={types:{BOOLEAN:"boolean",STRING:"string",NUMBER:"number",OBJECT:"object"},ensureTypedArg:function(e,t,i){return(void 0===e?"undefined":n(e))===t?e:i},ensureArrayTypedArg:function(e,t,i){if(Array.isArray(e)){for(var r=e.length-1;r>=0;--r)if(n(e[r])!==t)return i;return e}return this.ensureTypedArg(e,t,i)},ensureInstanceOf:function(e,t,i){return void 0!==t&&e instanceof t?e:i},ensureArrayInstanceOf:function(e,t,i){if(Array.isArray(e)){for(var r=e.length-1;r>=0;--r)if(void 0!==t&&e[r]instanceof t==0)return i;return e}return this.ensureInstanceOf(e,t,i)},ensureValueOverLifetimeCompliance:function(e,t,i){t=t||3,i=i||3,!1===Array.isArray(e._value)&&(e._value=[e._value]),!1===Array.isArray(e._spread)&&(e._spread=[e._spread]);var r=this.clamp(e._value.length,t,i),a=this.clamp(e._spread.length,t,i),n=Math.max(r,a);e._value.length!==n&&(e._value=this.interpolateArray(e._value,n)),e._spread.length!==n&&(e._spread=this.interpolateArray(e._spread,n))},interpolateArray:function(e,t){for(var i=e.length,r=["function"==typeof e[0].clone?e[0].clone():e[0]],a=(i-1)/(t-1),n=1;t-1>n;++n){var o=n*a,s=Math.floor(o),l=Math.ceil(o),c=o-s;r[n]=this.lerpTypeAgnostic(e[s],e[l],c)}return r.push("function"==typeof e[i-1].clone?e[i-1].clone():e[i-1]),r},clamp:function(e,t,i){return Math.max(t,Math.min(e,i))},zeroToEpsilon:function(e,t){var i=1e-5,r=e;return r=t?Math.random()*i*10:i,0>e&&e>-i&&(r=-r),r},lerpTypeAgnostic:function(e,t,i){var r,a=this.types;return(void 0===e?"undefined":n(e))===a.NUMBER&&(void 0===t?"undefined":n(t))===a.NUMBER?e+(t-e)*i:e instanceof o.Vector2&&t instanceof o.Vector2?(r=e.clone(),r.x=this.lerp(e.x,t.x,i),r.y=this.lerp(e.y,t.y,i),r):e instanceof o.Vector3&&t instanceof o.Vector3?(r=e.clone(),r.x=this.lerp(e.x,t.x,i),r.y=this.lerp(e.y,t.y,i),r.z=this.lerp(e.z,t.z,i),r):e instanceof o.Vector4&&t instanceof o.Vector4?(r=e.clone(),r.x=this.lerp(e.x,t.x,i),r.y=this.lerp(e.y,t.y,i),r.z=this.lerp(e.z,t.z,i),r.w=this.lerp(e.w,t.w,i),r):e instanceof o.Color&&t instanceof o.Color?(r=e.clone(),r.r=this.lerp(e.r,t.r,i),r.g=this.lerp(e.g,t.g,i),r.b=this.lerp(e.b,t.b,i),r):void console.warn("Invalid argument types, or argument types do not match:",e,t)},lerp:function(e,t,i){return e+(t-e)*i},roundToNearestMultiple:function(e,t){var i=0;return 0===t?e:(i=Math.abs(e)%t,0===i?e:0>e?-(Math.abs(e)-i):e+t-i)},arrayValuesAreEqual:function(e){for(var t=0;t<e.length-1;++t)if(e[t]!==e[t+1])return!1;return!0},randomFloat:function(e,t){return e+t*(Math.random()-.5)},randomVector3:function(e,t,i,r,a){var n=i.x+(Math.random()*r.x-.5*r.x),o=i.y+(Math.random()*r.y-.5*r.y),s=i.z+(Math.random()*r.z-.5*r.z);a&&(n=.5*-a.x+this.roundToNearestMultiple(n,a.x),o=.5*-a.y+this.roundToNearestMultiple(o,a.y),s=.5*-a.z+this.roundToNearestMultiple(s,a.z)),e.typedArray.setVec3Components(t,n,o,s)},randomColor:function(e,t,i,r){var a=i.r+Math.random()*r.x,n=i.g+Math.random()*r.y,o=i.b+Math.random()*r.z;a=this.clamp(a,0,1),n=this.clamp(n,0,1),o=this.clamp(o,0,1),e.typedArray.setVec3Components(t,a,n,o)},randomColorAsHex:function(){var e=new o.Color;return function(t,i,r,a){for(var n=r.length,o=[],s=0;n>s;++s){var l=a[s];e.copy(r[s]),e.r+=Math.random()*l.x-.5*l.x,e.g+=Math.random()*l.y-.5*l.y,e.b+=Math.random()*l.z-.5*l.z,e.r=this.clamp(e.r,0,1),e.g=this.clamp(e.g,0,1),e.b=this.clamp(e.b,0,1),o.push(e.getHex())}t.typedArray.setVec4Components(i,o[0],o[1],o[2],o[3])}}(),randomVector3OnSphere:function(e,t,i,r,a,n,o,s){var l=2*Math.random()-1,c=6.2832*Math.random(),u=Math.sqrt(1-l*l),h=this.randomFloat(r,a),p=0,d=0,m=0;o&&(h=Math.round(h/o)*o),p=u*Math.cos(c)*h,d=u*Math.sin(c)*h,m=l*h,p*=n.x,d*=n.y,m*=n.z,p+=i.x,d+=i.y,m+=i.z,e.typedArray.setVec3Components(t,p,d,m)},seededRandom:function(e){var t=1e4*Math.sin(e);return t-(0|t)},randomVector3OnDisc:function(e,t,i,r,a,n,o){var s=6.2832*Math.random(),l=Math.abs(this.randomFloat(r,a)),c=0,u=0,h=0;o&&(l=Math.round(l/o)*o),c=Math.cos(s)*l,u=Math.sin(s)*l,c*=n.x,u*=n.y,c+=i.x,u+=i.y,h+=i.z,e.typedArray.setVec3Components(t,c,u,h)},randomDirectionVector3OnSphere:function(){var e=new o.Vector3;return function(t,i,r,a,n,o,s,l){e.copy(o),e.x-=r,e.y-=a,e.z-=n,e.normalize().multiplyScalar(-this.randomFloat(s,l)),t.typedArray.setVec3Components(i,e.x,e.y,e.z)}}(),randomDirectionVector3OnDisc:function(){var e=new o.Vector3;return function(t,i,r,a,n,o,s,l){e.copy(o),e.x-=r,e.y-=a,e.z-=n,e.normalize().multiplyScalar(-this.randomFloat(s,l)),t.typedArray.setVec3Components(i,e.x,e.y,0)}}(),getPackedRotationAxis:function(){var e=new o.Vector3,t=new o.Vector3,i=new o.Color,r=new o.Vector3(1,1,1);return function(a,n){return e.copy(a).normalize(),t.copy(n).normalize(),e.x+=.5*-n.x+Math.random()*n.x,e.y+=.5*-n.y+Math.random()*n.y,e.z+=.5*-n.z+Math.random()*n.z,e.normalize().add(r).multiplyScalar(.5),i.setRGB(e.x,e.y,e.z),i.getHex()}}()},s.Group=function(e){var t=s.utils,i=t.types;e=t.ensureTypedArg(e,i.OBJECT,{}),e.texture=t.ensureTypedArg(e.texture,i.OBJECT,{}),this.uuid=o.Math.generateUUID(),this.fixedTimeStep=t.ensureTypedArg(e.fixedTimeStep,i.NUMBER,.016),this.texture=t.ensureInstanceOf(e.texture.value,o.Texture,null),this.textureFrames=t.ensureInstanceOf(e.texture.frames,o.Vector2,new o.Vector2(1,1)),this.textureFrameCount=t.ensureTypedArg(e.texture.frameCount,i.NUMBER,this.textureFrames.x*this.textureFrames.y),this.textureLoop=t.ensureTypedArg(e.texture.loop,i.NUMBER,1),this.textureFrames.max(new o.Vector2(1,1)),this.hasPerspective=t.ensureTypedArg(e.hasPerspective,i.BOOLEAN,!0),this.colorize=t.ensureTypedArg(e.colorize,i.BOOLEAN,!0),this.maxParticleCount=t.ensureTypedArg(e.maxParticleCount,i.NUMBER,null),this.blending=t.ensureTypedArg(e.blending,i.NUMBER,o.AdditiveBlending),this.transparent=t.ensureTypedArg(e.transparent,i.BOOLEAN,!0),this.alphaTest=parseFloat(t.ensureTypedArg(e.alphaTest,i.NUMBER,0)),this.depthWrite=t.ensureTypedArg(e.depthWrite,i.BOOLEAN,!1),this.depthTest=t.ensureTypedArg(e.depthTest,i.BOOLEAN,!0),this.fog=t.ensureTypedArg(e.fog,i.BOOLEAN,!0),this.scale=t.ensureTypedArg(e.scale,i.NUMBER,300),this.emitters=[],this.emitterIDs=[],this._pool=[],this._poolCreationSettings=null,this._createNewWhenPoolEmpty=0,this._attributesNeedRefresh=!1,this._attributesNeedDynamicReset=!1,this.particleCount=0,this.uniforms={texture:{type:"t",value:this.texture},textureAnimation:{type:"v4",value:new o.Vector4(this.textureFrames.x,this.textureFrames.y,this.textureFrameCount,Math.max(Math.abs(this.textureLoop),1))},fogColor:{type:"c",value:null},fogNear:{type:"f",value:10},fogFar:{type:"f",value:200},fogDensity:{type:"f",value:.5},deltaTime:{type:"f",value:0},runTime:{type:"f",value:0},scale:{type:"f",value:this.scale}},this.defines={HAS_PERSPECTIVE:this.hasPerspective,COLORIZE:this.colorize,VALUE_OVER_LIFETIME_LENGTH:s.valueOverLifetimeLength,SHOULD_ROTATE_TEXTURE:!1,SHOULD_ROTATE_PARTICLES:!1,SHOULD_WIGGLE_PARTICLES:!1,SHOULD_CALCULATE_SPRITE:this.textureFrames.x>1||this.textureFrames.y>1},this.attributes={position:new s.ShaderAttribute("v3",!0),acceleration:new s.ShaderAttribute("v4",!0),velocity:new s.ShaderAttribute("v3",!0),rotation:new s.ShaderAttribute("v4",!0),rotationCenter:new s.ShaderAttribute("v3",!0),params:new s.ShaderAttribute("v4",!0),size:new s.ShaderAttribute("v4",!0),angle:new s.ShaderAttribute("v4",!0),color:new s.ShaderAttribute("v4",!0),opacity:new s.ShaderAttribute("v4",!0)},this.attributeKeys=Object.keys(this.attributes),this.attributeCount=this.attributeKeys.length,this.material=new o.ShaderMaterial({uniforms:this.uniforms,vertexShader:s.shaders.vertex,fragmentShader:s.shaders.fragment,blending:this.blending,transparent:this.transparent,alphaTest:this.alphaTest,depthWrite:this.depthWrite,depthTest:this.depthTest,defines:this.defines,fog:this.fog}),this.geometry=new o.BufferGeometry,this.mesh=new o.Points(this.geometry,this.material),null===this.maxParticleCount&&console.warn("SPE.Group: No maxParticleCount specified. Adding emitters after rendering will probably cause errors.")},s.Group.constructor=s.Group,s.Group.prototype._updateDefines=function(){var e,t=this.emitters,i=t.length-1,r=this.defines;for(i;i>=0;--i)e=t[i],r.SHOULD_CALCULATE_SPRITE||(r.SHOULD_ROTATE_TEXTURE=r.SHOULD_ROTATE_TEXTURE||!!Math.max(Math.max.apply(null,e.angle.value),Math.max.apply(null,e.angle.spread))),r.SHOULD_ROTATE_PARTICLES=r.SHOULD_ROTATE_PARTICLES||!!Math.max(e.rotation.angle,e.rotation.angleSpread),r.SHOULD_WIGGLE_PARTICLES=r.SHOULD_WIGGLE_PARTICLES||!!Math.max(e.wiggle.value,e.wiggle.spread);this.material.needsUpdate=!0},s.Group.prototype._applyAttributesToGeometry=function(){var e,t,i=this.attributes,r=this.geometry,a=r.attributes;for(var n in i)i.hasOwnProperty(n)&&(e=i[n],t=a[n],t?t.array=e.typedArray.array:r.addAttribute(n,e.bufferAttribute),e.bufferAttribute.needsUpdate=!0);this.geometry.setDrawRange(0,this.particleCount)},s.Group.prototype.addEmitter=function(e){if(e instanceof s.Emitter==0)return void console.error("`emitter` argument must be instance of SPE.Emitter. Was provided with:",e);if(this.emitterIDs.indexOf(e.uuid)>-1)return void console.error("Emitter already exists in this group. Will not add again.");if(null!==e.group)return void console.error("Emitter already belongs to another group. Will not add to requested group.");var t=this.attributes,i=this.particleCount,r=i+e.particleCount;this.particleCount=r,null!==this.maxParticleCount&&this.particleCount>this.maxParticleCount&&console.warn("SPE.Group: maxParticleCount exceeded. Requesting",this.particleCount,"particles, can support only",this.maxParticleCount),e._calculatePPSValue(e.maxAge._value+e.maxAge._spread),e._setBufferUpdateRanges(this.attributeKeys),e._setAttributeOffset(i),e.group=this,e.attributes=this.attributes;for(var a in t)t.hasOwnProperty(a)&&t[a]._createBufferAttribute(null!==this.maxParticleCount?this.maxParticleCount:this.particleCount);for(var n=i;r>n;++n)e._assignPositionValue(n),e._assignForceValue(n,"velocity"),e._assignForceValue(n,"acceleration"),e._assignAbsLifetimeValue(n,"opacity"),e._assignAbsLifetimeValue(n,"size"),e._assignAngleValue(n),e._assignRotationValue(n),e._assignParamsValue(n),e._assignColorValue(n);return this._applyAttributesToGeometry(),this.emitters.push(e),this.emitterIDs.push(e.uuid),this._updateDefines(e),this.material.needsUpdate=!0,this.geometry.needsUpdate=!0,this._attributesNeedRefresh=!0,this},s.Group.prototype.removeEmitter=function(e){var t=this.emitterIDs.indexOf(e.uuid);if(e instanceof s.Emitter==0)return void console.error("`emitter` argument must be instance of SPE.Emitter. Was provided with:",e);if(-1===t)return void console.error("Emitter does not exist in this group. Will not remove.");for(var i=e.attributeOffset,r=i+e.particleCount,a=this.attributes.params.typedArray,n=i;r>n;++n)a.array[4*n]=0,a.array[4*n+1]=0;this.emitters.splice(t,1),this.emitterIDs.splice(t,1);for(var o in this.attributes)this.attributes.hasOwnProperty(o)&&this.attributes[o].splice(i,r);this.particleCount-=e.particleCount,e._onRemove(),this._attributesNeedRefresh=!0},s.Group.prototype.getFromPool=function(){var e=this._pool,t=this._createNewWhenPoolEmpty;if(e.length)return e.pop();if(t){var i=new s.Emitter(this._poolCreationSettings);return this.addEmitter(i),i}return null},s.Group.prototype.releaseIntoPool=function(e){return e instanceof s.Emitter==0?void console.error("Argument is not instanceof SPE.Emitter:",e):(e.reset(),this._pool.unshift(e),this)},s.Group.prototype.getPool=function(){return this._pool},s.Group.prototype.addPool=function(e,t,i){var r;this._poolCreationSettings=t,this._createNewWhenPoolEmpty=!!i;for(var a=0;e>a;++a)r=Array.isArray(t)?new s.Emitter(t[a]):new s.Emitter(t),this.addEmitter(r),this.releaseIntoPool(r);return this},s.Group.prototype._triggerSingleEmitter=function(e){var t=this.getFromPool(),i=this;return null===t?void console.log("SPE.Group pool ran out."):(e instanceof o.Vector3&&(t.position.value.copy(e),t.position.value=t.position.value),t.enable(),setTimeout(function(){t.disable(),i.releaseIntoPool(t)},1e3*Math.max(t.duration,t.maxAge.value+t.maxAge.spread)),this)},s.Group.prototype.triggerPoolEmitter=function(e,t){if("number"==typeof e&&e>1)for(var i=0;e>i;++i)this._triggerSingleEmitter(t);else this._triggerSingleEmitter(t);return this},s.Group.prototype._updateUniforms=function(e){this.uniforms.runTime.value+=e,this.uniforms.deltaTime.value=e},s.Group.prototype._resetBufferRanges=function(){var e=this.attributeKeys,t=this.attributeCount-1,i=this.attributes;for(t;t>=0;--t)i[e[t]].resetUpdateRange()},s.Group.prototype._updateBuffers=function(e){var t,i,r,a=this.attributeKeys,n=this.attributeCount-1,o=this.attributes,s=e.bufferUpdateRanges;for(n;n>=0;--n)t=a[n],i=s[t],r=o[t],r.setUpdateRange(i.min,i.max),r.flagUpdate()},s.Group.prototype.tick=function(e){var t,i=this.emitters,r=i.length,a=e||this.fixedTimeStep,n=this.attributeKeys,o=this.attributes;if(this._updateUniforms(a),this._resetBufferRanges(),0!==r||!1!==this._attributesNeedRefresh||!1!==this._attributesNeedDynamicReset){for(var s,t=0;r>t;++t)s=i[t],s.tick(a),this._updateBuffers(s);if(!0===this._attributesNeedDynamicReset){for(t=this.attributeCount-1;t>=0;--t)o[n[t]].resetDynamic();this._attributesNeedDynamicReset=!1}if(!0===this._attributesNeedRefresh){for(t=this.attributeCount-1;t>=0;--t)o[n[t]].forceUpdateAll();this._attributesNeedRefresh=!1,this._attributesNeedDynamicReset=!0}}},s.Group.prototype.dispose=function(){return this.geometry.dispose(),this.material.dispose(),this},s.Emitter=function(e){var t=s.utils,i=t.types,r=s.valueOverLifetimeLength;e=t.ensureTypedArg(e,i.OBJECT,{}),e.position=t.ensureTypedArg(e.position,i.OBJECT,{}),e.velocity=t.ensureTypedArg(e.velocity,i.OBJECT,{}),e.acceleration=t.ensureTypedArg(e.acceleration,i.OBJECT,{}),e.radius=t.ensureTypedArg(e.radius,i.OBJECT,{}),e.drag=t.ensureTypedArg(e.drag,i.OBJECT,{}),e.rotation=t.ensureTypedArg(e.rotation,i.OBJECT,{}),e.color=t.ensureTypedArg(e.color,i.OBJECT,{}),e.opacity=t.ensureTypedArg(e.opacity,i.OBJECT,{}),e.size=t.ensureTypedArg(e.size,i.OBJECT,{}),e.angle=t.ensureTypedArg(e.angle,i.OBJECT,{}),e.wiggle=t.ensureTypedArg(e.wiggle,i.OBJECT,{}),e.maxAge=t.ensureTypedArg(e.maxAge,i.OBJECT,{}),e.onParticleSpawn&&console.warn("onParticleSpawn has been removed. Please set properties directly to alter values at runtime."),this.uuid=o.Math.generateUUID(),this.type=t.ensureTypedArg(e.type,i.NUMBER,s.distributions.BOX),this.position={_value:t.ensureInstanceOf(e.position.value,o.Vector3,new o.Vector3),_spread:t.ensureInstanceOf(e.position.spread,o.Vector3,new o.Vector3),_spreadClamp:t.ensureInstanceOf(e.position.spreadClamp,o.Vector3,new o.Vector3),_distribution:t.ensureTypedArg(e.position.distribution,i.NUMBER,this.type),_randomise:t.ensureTypedArg(e.position.randomise,i.BOOLEAN,!1),_radius:t.ensureTypedArg(e.position.radius,i.NUMBER,10),_radiusScale:t.ensureInstanceOf(e.position.radiusScale,o.Vector3,new o.Vector3(1,1,1)),_distributionClamp:t.ensureTypedArg(e.position.distributionClamp,i.NUMBER,0)},this.velocity={_value:t.ensureInstanceOf(e.velocity.value,o.Vector3,new o.Vector3),_spread:t.ensureInstanceOf(e.velocity.spread,o.Vector3,new o.Vector3),_distribution:t.ensureTypedArg(e.velocity.distribution,i.NUMBER,this.type),_randomise:t.ensureTypedArg(e.position.randomise,i.BOOLEAN,!1)},this.acceleration={_value:t.ensureInstanceOf(e.acceleration.value,o.Vector3,new o.Vector3),_spread:t.ensureInstanceOf(e.acceleration.spread,o.Vector3,new o.Vector3),_distribution:t.ensureTypedArg(e.acceleration.distribution,i.NUMBER,this.type),_randomise:t.ensureTypedArg(e.position.randomise,i.BOOLEAN,!1)},this.drag={_value:t.ensureTypedArg(e.drag.value,i.NUMBER,0),_spread:t.ensureTypedArg(e.drag.spread,i.NUMBER,0),_randomise:t.ensureTypedArg(e.position.randomise,i.BOOLEAN,!1)},this.wiggle={_value:t.ensureTypedArg(e.wiggle.value,i.NUMBER,0),_spread:t.ensureTypedArg(e.wiggle.spread,i.NUMBER,0)},this.rotation={_axis:t.ensureInstanceOf(e.rotation.axis,o.Vector3,new o.Vector3(0,1,0)),_axisSpread:t.ensureInstanceOf(e.rotation.axisSpread,o.Vector3,new o.Vector3),_angle:t.ensureTypedArg(e.rotation.angle,i.NUMBER,0),_angleSpread:t.ensureTypedArg(e.rotation.angleSpread,i.NUMBER,0),_static:t.ensureTypedArg(e.rotation.static,i.BOOLEAN,!1),_center:t.ensureInstanceOf(e.rotation.center,o.Vector3,this.position._value.clone()),_randomise:t.ensureTypedArg(e.position.randomise,i.BOOLEAN,!1)},this.maxAge={_value:t.ensureTypedArg(e.maxAge.value,i.NUMBER,2),_spread:t.ensureTypedArg(e.maxAge.spread,i.NUMBER,0)},this.color={_value:t.ensureArrayInstanceOf(e.color.value,o.Color,new o.Color),_spread:t.ensureArrayInstanceOf(e.color.spread,o.Vector3,new o.Vector3),_randomise:t.ensureTypedArg(e.position.randomise,i.BOOLEAN,!1)},this.opacity={_value:t.ensureArrayTypedArg(e.opacity.value,i.NUMBER,1),_spread:t.ensureArrayTypedArg(e.opacity.spread,i.NUMBER,0),_randomise:t.ensureTypedArg(e.position.randomise,i.BOOLEAN,!1)},this.size={_value:t.ensureArrayTypedArg(e.size.value,i.NUMBER,1),_spread:t.ensureArrayTypedArg(e.size.spread,i.NUMBER,0),_randomise:t.ensureTypedArg(e.position.randomise,i.BOOLEAN,!1)},this.angle={_value:t.ensureArrayTypedArg(e.angle.value,i.NUMBER,0),_spread:t.ensureArrayTypedArg(e.angle.spread,i.NUMBER,0),_randomise:t.ensureTypedArg(e.position.randomise,i.BOOLEAN,!1)},this.particleCount=t.ensureTypedArg(e.particleCount,i.NUMBER,100),this.duration=t.ensureTypedArg(e.duration,i.NUMBER,null),this.isStatic=t.ensureTypedArg(e.isStatic,i.BOOLEAN,!1),this.activeMultiplier=t.ensureTypedArg(e.activeMultiplier,i.NUMBER,1),this.direction=t.ensureTypedArg(e.direction,i.NUMBER,1),this.alive=t.ensureTypedArg(e.alive,i.BOOLEAN,!0),this.particlesPerSecond=0,this.activationIndex=0,this.attributeOffset=0,this.attributeEnd=0,this.age=0,this.activeParticleCount=0,this.group=null,this.attributes=null,this.paramsArray=null,this.resetFlags={position:t.ensureTypedArg(e.position.randomise,i.BOOLEAN,!1)||t.ensureTypedArg(e.radius.randomise,i.BOOLEAN,!1),velocity:t.ensureTypedArg(e.velocity.randomise,i.BOOLEAN,!1),acceleration:t.ensureTypedArg(e.acceleration.randomise,i.BOOLEAN,!1)||t.ensureTypedArg(e.drag.randomise,i.BOOLEAN,!1),rotation:t.ensureTypedArg(e.rotation.randomise,i.BOOLEAN,!1),rotationCenter:t.ensureTypedArg(e.rotation.randomise,i.BOOLEAN,!1),size:t.ensureTypedArg(e.size.randomise,i.BOOLEAN,!1),color:t.ensureTypedArg(e.color.randomise,i.BOOLEAN,!1),opacity:t.ensureTypedArg(e.opacity.randomise,i.BOOLEAN,!1),angle:t.ensureTypedArg(e.angle.randomise,i.BOOLEAN,!1)},this.updateFlags={},this.updateCounts={},this.updateMap={maxAge:"params",position:"position",velocity:"velocity",acceleration:"acceleration",drag:"acceleration",wiggle:"params",rotation:"rotation",size:"size",color:"color",opacity:"opacity",angle:"angle"};for(var a in this.updateMap)this.updateMap.hasOwnProperty(a)&&(this.updateCounts[this.updateMap[a]]=0,this.updateFlags[this.updateMap[a]]=!1,this._createGetterSetters(this[a],a));this.bufferUpdateRanges={},this.attributeKeys=null,this.attributeCount=0,t.ensureValueOverLifetimeCompliance(this.color,r,r),t.ensureValueOverLifetimeCompliance(this.opacity,r,r),t.ensureValueOverLifetimeCompliance(this.size,r,r),t.ensureValueOverLifetimeCompliance(this.angle,r,r)},s.Emitter.constructor=s.Emitter,s.Emitter.prototype._createGetterSetters=function(e,t){var i=this;for(var r in e)if(e.hasOwnProperty(r)){var a=r.replace("_","");Object.defineProperty(e,a,{get:function(e){return function(){return this[e]}}(r),set:function(e){return function(r){var a=i.updateMap[t],n=this[e],o=s.valueOverLifetimeLength;"_rotationCenter"===e?(i.updateFlags.rotationCenter=!0,i.updateCounts.rotationCenter=0):"_randomise"===e?i.resetFlags[a]=r:(i.updateFlags[a]=!0,i.updateCounts[a]=0),i.group._updateDefines(),this[e]=r,Array.isArray(n)&&s.utils.ensureValueOverLifetimeCompliance(i[t],o,o)}}(r)})}},s.Emitter.prototype._setBufferUpdateRanges=function(e){this.attributeKeys=e,this.attributeCount=e.length;for(var t=this.attributeCount-1;t>=0;--t)this.bufferUpdateRanges[e[t]]={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY}},s.Emitter.prototype._calculatePPSValue=function(e){var t=this.particleCount;this.duration?this.particlesPerSecond=t/(e<this.duration?e:this.duration):this.particlesPerSecond=t/e},s.Emitter.prototype._setAttributeOffset=function(e){this.attributeOffset=e,this.activationIndex=e,this.activationEnd=e+this.particleCount},s.Emitter.prototype._assignValue=function(e,t){switch(e){case"position":this._assignPositionValue(t);break;case"velocity":case"acceleration":this._assignForceValue(t,e);break;case"size":case"opacity":this._assignAbsLifetimeValue(t,e);break;case"angle":this._assignAngleValue(t);break;case"params":this._assignParamsValue(t);break;case"rotation":this._assignRotationValue(t);break;case"color":this._assignColorValue(t)}},s.Emitter.prototype._assignPositionValue=function(e){var t=s.distributions,i=s.utils,r=this.position,a=this.attributes.position,n=r._value,o=r._spread;switch(r._distribution){case t.BOX:i.randomVector3(a,e,n,o,r._spreadClamp);break;case t.SPHERE:i.randomVector3OnSphere(a,e,n,r._radius,r._spread.x,r._radiusScale,r._spreadClamp.x,r._distributionClamp||this.particleCount);break;case t.DISC:i.randomVector3OnDisc(a,e,n,r._radius,r._spread.x,r._radiusScale,r._spreadClamp.x)}},s.Emitter.prototype._assignForceValue=function(e,t){var i,r,a,n,o,l=s.distributions,c=s.utils,u=this[t],h=u._value,p=u._spread;switch(u._distribution){case l.BOX:c.randomVector3(this.attributes[t],e,h,p);break;case l.SPHERE:i=this.attributes.position.typedArray.array,o=3*e,r=i[o],a=i[o+1],n=i[o+2],c.randomDirectionVector3OnSphere(this.attributes[t],e,r,a,n,this.position._value,u._value.x,u._spread.x);break;case l.DISC:i=this.attributes.position.typedArray.array,o=3*e,r=i[o],a=i[o+1],n=i[o+2],c.randomDirectionVector3OnDisc(this.attributes[t],e,r,a,n,this.position._value,u._value.x,u._spread.x)}if("acceleration"===t){var d=c.clamp(c.randomFloat(this.drag._value,this.drag._spread),0,1);this.attributes.acceleration.typedArray.array[4*e+3]=d}},s.Emitter.prototype._assignAbsLifetimeValue=function(e,t){var i,r=this.attributes[t].typedArray,a=this[t],n=s.utils;n.arrayValuesAreEqual(a._value)&&n.arrayValuesAreEqual(a._spread)?(i=Math.abs(n.randomFloat(a._value[0],a._spread[0])),r.setVec4Components(e,i,i,i,i)):r.setVec4Components(e,Math.abs(n.randomFloat(a._value[0],a._spread[0])),Math.abs(n.randomFloat(a._value[1],a._spread[1])),Math.abs(n.randomFloat(a._value[2],a._spread[2])),Math.abs(n.randomFloat(a._value[3],a._spread[3])))},s.Emitter.prototype._assignAngleValue=function(e){var t,i=this.attributes.angle.typedArray,r=this.angle,a=s.utils;a.arrayValuesAreEqual(r._value)&&a.arrayValuesAreEqual(r._spread)?(t=a.randomFloat(r._value[0],r._spread[0]),i.setVec4Components(e,t,t,t,t)):i.setVec4Components(e,a.randomFloat(r._value[0],r._spread[0]),a.randomFloat(r._value[1],r._spread[1]),a.randomFloat(r._value[2],r._spread[2]),a.randomFloat(r._value[3],r._spread[3]))},s.Emitter.prototype._assignParamsValue=function(e){this.attributes.params.typedArray.setVec4Components(e,this.isStatic?1:0,0,Math.abs(s.utils.randomFloat(this.maxAge._value,this.maxAge._spread)),s.utils.randomFloat(this.wiggle._value,this.wiggle._spread))},s.Emitter.prototype._assignRotationValue=function(e){this.attributes.rotation.typedArray.setVec3Components(e,s.utils.getPackedRotationAxis(this.rotation._axis,this.rotation._axisSpread),s.utils.randomFloat(this.rotation._angle,this.rotation._angleSpread),this.rotation._static?0:1),this.attributes.rotationCenter.typedArray.setVec3(e,this.rotation._center)},s.Emitter.prototype._assignColorValue=function(e){s.utils.randomColorAsHex(this.attributes.color,e,this.color._value,this.color._spread)},s.Emitter.prototype._resetParticle=function(e){for(var t,i,r=this.resetFlags,a=this.updateFlags,n=this.updateCounts,o=this.attributeKeys,s=this.attributeCount-1;s>=0;--s)t=o[s],i=a[t],!0!==r[t]&&!0!==i||(this._assignValue(t,e),this._updateAttributeUpdateRange(t,e),!0===i&&n[t]===this.particleCount?(a[t]=!1,n[t]=0):1==i&&++n[t])},s.Emitter.prototype._updateAttributeUpdateRange=function(e,t){var i=this.bufferUpdateRanges[e];i.min=Math.min(t,i.min),i.max=Math.max(t,i.max)},s.Emitter.prototype._resetBufferRanges=function(){var e,t=this.bufferUpdateRanges,i=this.bufferUpdateKeys,r=this.bufferUpdateCount-1;for(r;r>=0;--r)e=i[r],t[e].min=Number.POSITIVE_INFINITY,t[e].max=Number.NEGATIVE_INFINITY},s.Emitter.prototype._onRemove=function(){this.particlesPerSecond=0,this.attributeOffset=0,this.activationIndex=0,this.activeParticleCount=0,this.group=null,this.attributes=null,this.paramsArray=null,this.age=0},s.Emitter.prototype._decrementParticleCount=function(){--this.activeParticleCount},s.Emitter.prototype._incrementParticleCount=function(){++this.activeParticleCount},s.Emitter.prototype._checkParticleAges=function(e,t,i,r){for(var a,n,o,s,l=t-1;l>=e;--l)a=4*l,0!==(s=i[a])&&(o=i[a+1],n=i[a+2],1===this.direction?(o+=r)>=n&&(o=0,s=0,this._decrementParticleCount()):0>=(o-=r)&&(o=n,s=0,this._decrementParticleCount()),i[a]=s,i[a+1]=o,this._updateAttributeUpdateRange("params",l))},s.Emitter.prototype._activateParticles=function(e,t,i,r){for(var a,n,o=this.direction,s=e;t>s;++s)a=4*s,0!=i[a]&&1!==this.particleCount||(this._incrementParticleCount(),i[a]=1,this._resetParticle(s),n=r*(s-e),i[a+1]=-1===o?i[a+2]-n:n,this._updateAttributeUpdateRange("params",s))},s.Emitter.prototype.tick=function(e){if(!this.isStatic){null===this.paramsArray&&(this.paramsArray=this.attributes.params.typedArray.array);var t=this.attributeOffset,i=t+this.particleCount,r=this.paramsArray,a=this.particlesPerSecond*this.activeMultiplier*e,n=this.activationIndex;if(this._resetBufferRanges(),this._checkParticleAges(t,i,r,e),!1===this.alive)return void(this.age=0);if(null!==this.duration&&this.age>this.duration)return this.alive=!1,void(this.age=0);var o=1===this.particleCount?n:0|n,s=Math.min(o+a,this.activationEnd),l=s-this.activationIndex|0,c=l>0?e/l:0;this._activateParticles(o,s,r,c),this.activationIndex+=a,this.activationIndex>i&&(this.activationIndex=t),this.age+=e}},s.Emitter.prototype.reset=function(e){if(this.age=0,this.alive=!1,!0===e){for(var t,i=this.attributeOffset,r=i+this.particleCount,a=this.paramsArray,n=this.attributes.params.bufferAttribute,o=r-1;o>=i;--o)t=4*o,a[t]=0,a[t+1]=0;n.updateRange.offset=0,n.updateRange.count=-1,n.needsUpdate=!0}return this},s.Emitter.prototype.enable=function(){return this.alive=!0,this},s.Emitter.prototype.disable=function(){return this.alive=!1,this},s.Emitter.prototype.remove=function(){return null!==this.group?this.group.removeEmitter(this):console.error("Emitter does not belong to a group, cannot remove."),this}}],[7]);