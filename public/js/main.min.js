webpackJsonp([0],[function(e,t,i){"use strict";var n=i(1),a=i(2),s=i(8),o=e.exports=new Map;o.set("time",Date.now()),o.set("tick",0),o.set("controls",{}),o.set("scene",new n.Scene),o.set("renderer",new n.WebGLRenderer),o.set("camera",new n.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,5e3)),o.set("listener",new n.AudioListener),o.get("camera").add(o.get("listener")),o.set("player",{}),o.set("entities",[]),o.set("labels",[]),o.set("tweens",[]),o.set("world",new a.World),o.set("cache",{audio:{},json:{}}),o.set("events",s.channel("events")),o.set("load",function(e,t){t=t||{},e.castShadow=!0,e.receiveShadow=!0;for(var i=[],n=[],s=0;s<e.geometry.vertices.length;s++){var r=e.geometry.vertices[s];i.push(new a.Vec3(r.x,r.y,r.z))}for(var s=0;s<e.geometry.faces.length;s++){var l=e.geometry.faces[s];n.push([l.a,l.b,l.c])}var c=new a.ConvexPolyhedron(i,n),h=new a.Body({mass:t.mass||0,material:t.material||void 0});return h.addShape(c),h.position.copy(e.position),h.quaternion.copy(e.quaternion),o.get("world").add(h),{body:h,shape:c,mesh:e}})},,,,function(e,t,i){"use strict";function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function e(t,i,n){null===t&&(t=Function.prototype);var a=Object.getOwnPropertyDescriptor(t,i);if(void 0===a){var s=Object.getPrototypeOf(t);return null===s?void 0:e(s,i,n)}if("value"in a)return a.value;var o=a.get;if(void 0!==o)return o.call(n)},r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),l=i(1),c=i(2),h=i(6),d=i(0),u=i(3),p=t.Entity=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Entity",i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new l.Object3D,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new c.Body,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(s(this,e),console.log("Entity: "+t+" created"),this.id=t,this.uuid=Math.random(),this.events={},this.opts=a,this.sounds=[],this.opts.sounds)for(var o=0;o<this.opts.sounds.length;o++)this.loadAudio(this.opts.sounds[o],o);this.mesh=i,this.mesh.name=this.id,this.body=n,d.get("scene").add(i),d.get("world").add(n),d.get("entities").push(this)}return r(e,[{key:"update",value:function(e){this.mesh.position.copy(this.body.position),this.callEvent("update")}},{key:"remove",value:function(){this.callEvent("remove"),d.get("scene").remove(this.mesh),d.get("world").remove(this.body),d.get("entities").splice(d.get("entities").indexOf(this),1)}},{key:"loadAudio",value:function(e,t){var i=this;if(e)if(d.get("cache").audio[e])this.sounds[t]=new l.PositionalAudio(d.get("listener")),this.sounds[t].setBuffer(d.get("cache").audio[e]),this.sounds[t].setRefDistance(30),this.mesh&&this.mesh.add(this.sounds[t]),this.sounds[t].onEnded(function(){return i.sounds[t].stop()});else{var n=new l.AudioLoader;n.load("/assets/sfx/"+e,function(n){d.get("cache").audio[e]=n,i.sounds[t]=new l.PositionalAudio(d.get("listener")),i.sounds[t].setBuffer(n),i.sounds[t].setRefDistance(30),i.mesh.add(i.sounds[t]),i.sounds[t].onEnded(function(){return i.sounds[t].stop()})})}}},{key:"addEventListener",value:function(e,t){e in this.events||(this.events[e]=[]),this.events[e].push(t)}},{key:"removeEventListener",value:function(e,t){}},{key:"callEvent",value:function(e){if(e in this.events){for(var t=arguments.length,i=Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];var a=!0,s=!1,o=void 0;try{for(var r,l=this.events[e][Symbol.iterator]();!(a=(r=l.next()).done);a=!0){r.value.apply(void 0,i)}}catch(e){s=!0,o=e}finally{try{!a&&l.return&&l.return()}finally{if(s)throw o}}}}}]),e}(),m=t.Living=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Living Entity",i=arguments[1],a=arguments[2],o=arguments[3];s(this,t);var r=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,a,o));return r.lastDamaged=0,r.lastAttacked=0,r.lastUsedStamina=0,r.hp=Number,r.hpMax=Number,r.mp=Number,r.mpMax=Number,r.stm=Number,r.stmMax=Number,r.lvl=1,r.xp=0,r.xpMax=Math.pow(r.lvl,2)/.04,r.str=Number,r.dex=Number,r.int=Number,r.cnt=Number,r.chr=Number,r.inv=[],r.effects=[],r}return a(t,e),r(t,[{key:"gainXP",value:function(e){this.xp+=e,this.xpMax=Math.pow(this.lvl,2)/.04,this.xp>this.xpMax&&(this.lvl++,this.xp=0,this.callEvent("levelUp"))}},{key:"attack",value:function(e){d.get("controls").enabled&&(e.damage(this.dmg,this),this.lastAttacked=Date.now(),this.callEvent("attack"))}},{key:"damage",value:function(e,t){d.get("controls").enabled&&(this.hp-=e,this.hp<=0&&this.kill(t),this.lastDamaged=Date.now(),this.callEvent("damage"))}},{key:"heal",value:function(e,t,i){d.get("controls").enabled&&(this.hp+=e,this.mp+=i,this.stm+=t,this.hp>=this.hpMax&&(this.hp=this.hpMax),this.mp>=this.mpMax&&(this.mp=this.mpMax),this.stm>=this.stmMax&&(this.stm=this.stmMax),this.callEvent("heal"))}},{key:"kill",value:function(e){d.get("controls").enabled&&(this.remove(),this.callEvent("kill",{attacker:e}))}},{key:"update",value:function(e){o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"update",this).call(this,e),d.get("tick")%50==0&&this.heal(Date.now()-this.lastDamaged>5e3?1:0,1,Date.now()-this.lastUsedStamina>2e3?1:0)}}]),t}(p),v=t.AI=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"AI",i=arguments[1],a=arguments[2],o=arguments[3];s(this,t);var r=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,a,o));return r.target=null,r.seen=!1,r.tween=!1,r.hp=5,r.hpMax=5,r.mp=1,r.mpMax=1,r.stm=3,r.stmMax=3,r.str=1,r.dex=1,r.int=1,r.cnt=1,r.chr=1,r}return a(t,e),r(t,[{key:"update",value:function(e){var i=this;o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"update",this).call(this,e);var n=this.mesh.position,a=!0,s=!1,r=void 0;try{for(var c,u=d.get("entities")[Symbol.iterator]();!(a=(c=u.next()).done);a=!0){var p=c.value;p.id!=this.id&&(n.distanceTo(p.mesh.position)>50||this.data&&this.data.hostility&&this.data.hostility[1].has(p.id)||(this.target&&n.distanceTo(p.mesh.position)<n.distanceTo(this.target.mesh.position)?(this.target=p,this.sounds[0]&&d.get("controls").enabled&&this.sounds[0].play(),this.callEvent("newTarget",this.target)):this.target||(this.target=p,this.sounds[0]&&d.get("controls").enabled&&this.sounds[0].play(),this.callEvent("newTarget",this.target))))}}catch(e){s=!0,r=e}finally{try{!a&&u.return&&u.return()}finally{if(s)throw r}}this.target&&n.distanceTo(this.target.mesh.position)>50&&(this.target=null);var m=this.spd||7;if(this.addEventListener("damage",function(){i.sounds[2]&&d.get("controls").enabled&&!i.sounds[2].isPlaying&&i.hp>0&&i.sounds[2].play()}),this.addEventListener("kill",function(){i.sounds[3]&&d.get("controls").enabled&&!i.sounds[3].isPlaying&&i.sounds[3].play()}),this.target){var v=this.target.mesh.position;if(!this.tween){this.tween=!0;var y=(new l.Euler).copy(this.mesh.rotation);this.mesh.lookAt(new l.Vector3(v.x,n.y,v.z));var f=(new l.Euler).copy(this.mesh.rotation);this.mesh.rotation.copy(y);var g=new h.Tween(this.mesh.rotation).to({x:y.x,y:f.y,z:y.z},60).start().onComplete(function(){i.tween=!1,d.get("tweens").splice(d.get("tweens").indexOf(g),1)});d.get("tweens").push(g)}var w=0;w=this.data&&this.data.hostility[0].has(this.target.id)?-1:this.data&&this.data.hostility[2].has(this.target.id)?1:this.opts.hostility,this.hostility=w;var b=1;w>0&&(b*=-1),0!=w&&n.distanceTo(v)>(w>0?10:5)?(n.x<v.x?this.body.velocity.x+=b:n.x>v.x&&(this.body.velocity.x-=b),n.z<v.z?this.body.velocity.z+=b:n.z>v.z&&(this.body.velocity.z-=b)):d.get("tick")%50==0&&w<0&&(this.attack(this.target),this.sounds[1]&&d.get("controls").enabled&&this.sounds[1].play())}else this.body.velocity.x=0,this.body.velocity.z=0;this.body.velocity.x>m?this.body.velocity.x=m:this.body.velocity.x<-m&&(this.body.velocity.x=-m),this.body.velocity.z>m?this.body.velocity.z=m:this.body.velocity.z<-m&&(this.body.velocity.z=-m)}}]),t}(m);t.Player=function(e){function t(){s(this,t);var e=new c.Sphere(1.3),i=new c.Body({mass:5});i.addShape(e),i.addEventListener("collide",function(e){var t=e.contact,n=new c.Vec3(0,1,0),a=new c.Vec3;t.bi.id==i.id?t.ni.negate(a):a.copy(t.ni),a.dot(n)>.5&&i.velocity.y<=-60&&(h.hp+=Math.floor(i.velocity.y/5))});var a=new l.Raycaster(new l.Vector3(0,40,0),new l.Vector3(0,-1,0)),o=a.intersectObjects(d.get("scene").children,!0);if(o.length>0){var r=o[0].point;i.position.set(r.x,r.y,r.z)}else i.position.set(200,2,0);var h=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"player",new l.Object3D,i));return h.lvl=1,h.xp=0,h.hp=20,h.hpMax=20,h.stm=10,h.stmMax=10,h.mp=5,h.mpMax=5,h.spd=.5,h.dmg=1,h}return a(t,e),r(t,[{key:"update",value:function(e){o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"update",this).call(this,e),u("#hp").html(this.hp+"/"+this.hpMax+" hp"),this.body.velocity.x*=.925,this.body.velocity.z*=.925}},{key:"damage",value:function(e){o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"damage",this).call(this,e),u("#vignette").fadeIn(550).fadeOut(550)}}]),t}(m),t.Creature=function(e){function t(e,a){s(this,t);var o=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,new l.Object3D,new c.Body,a)),r=i(14);if(!r[e])throw new Error("Error: cannot find creature with id of "+e);var h=r[e];o.data=h,o.id=o.data.id,o.inv=h.inv;for(var u in h.stats)o[u]=h.stats[u];return(new l.ObjectLoader).load("/assets/3d/"+h.path+".json",function(e){d.get("cache").json[h.path]=e;var t=new c.Body({mass:5});t.addShape(new c.Sphere(1));var i=void 0;if(i=new c.Vec3(a.pos.x||10,a.pos.y||20,a.pos.z||10),h.meta&&h.meta.spawn){var n=h.meta.spawn;i=6==n.length?new c.Vec3(Math.interval(n[0],n[1]),Math.interval(n[2],n[3]),Math.interval(n[4],n[5])):new c.Vec3(n[0],n[1],n[2])}var s=new l.Raycaster(new l.Vector3(i.x,i.y,i.z),new l.Vector3(0,-1,0)),r=s.intersectObjects(d.get("scene").children,!0);if(r.length>0){var u=r[0].point;t.position.set(u.x,u.y+3,u.z)}else t.position.set(i.x,i.y,i.z);t.linearDamping=.9,e.traverse(function(e){var t=!0,i=!1,n=void 0;try{for(var a,s=h.mesh[Symbol.iterator]();!(t=(a=s.next()).done);t=!0){var o=a.value;if(o.name.toLowerCase()==e.name.toLowerCase())for(var r in o)e.material[r]=o[r],"color"==r&&(e.material[r]=new l.Color(o[r]))}}catch(e){i=!0,n=e}finally{try{!t&&s.return&&s.return()}finally{if(i)throw n}}}),o.mesh=e,d.get("scene").add(o.mesh),o.body=t,d.get("world").add(o.body)}),o.addEventListener("kill",function(t){var n=!0,a=!1,s=void 0;try{for(var r,l=o.inv[Symbol.iterator]();!(n=(r=l.next()).done);n=!0){var c=r.value,h=i(15);if(!h[c.id])throw new Error("Error: cannot find item with id of "+e);var u=Math.round(Math.random()*c.max)+c.min;if(u>c.max&&(u=c.max),u){for(var p=0;p<u;p++)t.attacker.inv.push(h[c.id]);t.attacker==d.get("player")&&(u>1?Materialize.toast(c.id+" ("+u+") added",1e3):Materialize.toast(c.id+" added",1e3))}}}catch(e){a=!0,s=e}finally{try{!n&&l.return&&l.return()}finally{if(a)throw s}}}),o}return a(t,e),r(t,[{key:"update",value:function(){if(o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"update",this).call(this),(!this.data.meta||!this.data.meta.spawn)&&this.mesh.position.distanceTo(d.get("player").mesh.position)>250){var e=new c.Vec3;e.x=Math.interval(d.get("player").mesh.position.x-200,d.get("player").mesh.position.x+200),e.y=20,e.z=Math.interval(d.get("player").mesh.position.x-200,d.get("player").mesh.position.x+200);var i=new l.Raycaster(new l.Vector3(e.x,e.y,e.z),new l.Vector3(0,-1,0)),n=i.intersectObjects(d.get("scene").children,!0);if(n.length>0){var a=n[0].point;this.body.position.set(a.x,a.y+3,a.z)}else this.body.position.set(e.x,e.y,e.z)}}}]),t}(v),t.NPC=function(e){function t(e,a){s(this,t);var o=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,new l.Object3D,new c.Body,a)),r=i(16);if(!r[e])throw new Error("Error: cannot find NPC with id of "+e);var h=r[e];o.data=h,o.inv=h.inv;for(var u in h.stats)o[u]=h.stats[u];(new l.ObjectLoader).load("/assets/3d/"+h.path+".json",function(e){e.scale.set(2,2,2);var t=new c.Body({mass:5});t.addShape(new c.Sphere(.75));var i=void 0;if(i=new c.Vec3(a.pos.x||10,a.pos.y||20,a.pos.z||10),h.meta&&h.meta.spawn){var n=h.meta.spawn;i=6==n.length?new c.Vec3(Math.interval(n[0],n[1]),Math.interval(n[2],n[3]),Math.interval(n[4],n[5])):new c.Vec3(n[0],n[1],n[2])}t.position.set(i.x,i.y,i.z),t.linearDamping=.9,o.mesh=e,d.get("scene").add(o.mesh),o.body=t,d.get("world").add(o.body)}),o.addEventListener("newTarget",function(e){o.hasChosenTarget=o.hasChosenTarget||!1,o.hasSpokenInteract=o.hasSpokenInteract||!1,o.hasChosenTarget||(o.target=null),o.sounds[0]=null}),o.addEventListener("interact",function(){var e=0,t=!0,i=!1,n=void 0;try{for(var a,s=d.get("player").inv[Symbol.iterator]();!(t=(a=s.next()).done);t=!0)"gelatin"==a.value.id&&e++}catch(e){i=!0,n=e}finally{try{!t&&s.return&&s.return()}finally{if(i)throw n}}if(e<5){var r=document.createElement("audio");r.src="/assets/sfx/wicket-request.mp3",r.addEventListener("ended",function(){new Audio("/assets/sfx/wicket-tutorial-inventory.mp3").play()}),r.play()}else o.hasChosenTarget=!0,o.target=d.get("player"),new Audio("/assets/sfx/wicket-thanks.mp3").play()});var p=d.get("events").subscribe("system.pointerlock.enter",function(){var e=document.createElement("audio");e.src="/assets/sfx/wicket-help.mp3",e.addEventListener("ended",function(){var e=document.createElement("audio");e.src="/assets/sfx/wicket-tutorial-look.mp3",e.addEventListener("ended",function(){var e=d.get("events").subscribe("player.look",function(){var t=document.createElement("audio");t.src="/assets/sfx/wicket-success.mp3",t.addEventListener("ended",function(){var t=document.createElement("audio");t.src="/assets/sfx/wicket-tutorial-move.mp3",t.addEventListener("ended",function(){var t=d.get("events").subscribe("player.move",function(){var e=document.createElement("audio");e.src="/assets/sfx/wicket-success.mp3",e.addEventListener("ended",function(){var e=document.createElement("audio");e.src="/assets/sfx/wicket-tutorial-attack.mp3",e.addEventListener("ended",function(){var e=d.get("events").subscribe("system.click",function(){var t=document.createElement("audio");t.src="/assets/sfx/wicket-success.mp3",t.addEventListener("ended",function(){var e=document.createElement("audio");e.src="/assets/sfx/wicket-help-2.mp3",e.addEventListener("ended",function(){new Audio("/assets/sfx/wicket-tutorial-interact.mp3").play()}),e.play()}),t.play(),e.unsubscribe()})}),e.play()}),e.play(),t.unsubscribe()});e.unsubscribe()}),t.play()}),t.play(),e.unsubscribe()})}),e.play()}),e.play(),p.unsubscribe()});return o}return a(t,e),t}(v)},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),s=i(0),o=i(3),r=function(){function e(t,i){n(this,e),o("#gui-title").text(t),o("#gui-content").html(i),this.show(),document.exitPointerLock()}return a(e,[{key:"show",value:function(){o("#gui").fadeIn(400)}},{key:"hide",value:function(){o("#gui").fadeOut(400)}}]),e}();t.default=r;var l=t.Inventory=function e(){n(this,e);var t=s.get("player").inv,i=o("<div>"),a=!0,l=!1,c=void 0;try{for(var h,d=t[Symbol.iterator]();!(a=(h=d.next()).done);a=!0){var u=h.value;o("<img>").attr("src",u.path).attr("title",u.name).attr("width",50).data("item",u).appendTo(i)}}catch(e){l=!0,c=e}finally{try{!a&&d.return&&d.return()}finally{if(l)throw c}}i.on("click","img",function(){if(o(this).hide(),o(this).data("item").effects)for(var e in o(this).data("item").effects)s.get("player")[e]+=o(this).data("item").effects[e];s.get("player").inv.splice(s.get("player").inv.indexOf(o(this).data("item"),1))}),new r("Inventory",i)};t.HUD=function(){function e(){n(this,e),this.canvas=document.getElementById("hud-canvas"),this.canvas.setAttribute("width",.7*window.innerWidth),this.ctx=this.canvas.getContext("2d"),this.centerX=this.canvas.width/2,this.centerY=this.canvas.height/2,this.radius=40,this.radiusSmall=30,s.get("events").subscribe("system.update",this.draw.bind(this))}return a(e,[{key:"draw",value:function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(this.centerX-this.radiusSmall-15,this.canvas.height-this.radiusSmall-15,this.radiusSmall,0,2*Math.PI,!1),this.ctx.clip(),this.ctx.fillStyle="#000080",this.ctx.fillRect(this.centerX-2*this.radiusSmall-15,this.canvas.height-15,2*this.radiusSmall,-s.get("player").mp/s.get("player").mpMax*this.radiusSmall*2),this.ctx.restore(),this.ctx.beginPath(),this.ctx.arc(this.centerX-this.radiusSmall-15,this.canvas.height-this.radiusSmall-15,this.radiusSmall,0,2*Math.PI,!1),this.ctx.lineWidth=4,this.ctx.strokeStyle="#000000",this.ctx.stroke(),this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(this.centerX+this.radiusSmall+15,this.canvas.height-this.radiusSmall-15,this.radiusSmall,0,2*Math.PI,!1),this.ctx.clip(),this.ctx.fillStyle="#006400",this.ctx.fillRect(this.centerX+15,this.canvas.height-15,2*this.radiusSmall,-s.get("player").stm/s.get("player").stmMax*this.radiusSmall*2),this.ctx.restore(),this.ctx.beginPath(),this.ctx.arc(this.centerX+this.radiusSmall+15,this.canvas.height-this.radiusSmall-15,this.radiusSmall,0,2*Math.PI,!1),this.ctx.lineWidth=4,this.ctx.strokeStyle="#000000",this.ctx.stroke(),this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(this.centerX,this.canvas.height-this.radius-5,this.radius,0,2*Math.PI,!1),this.ctx.clip(),this.ctx.fillStyle="#cc0000",this.ctx.fillRect(this.centerX-this.radius,this.canvas.height-5,2*this.radius,-s.get("player").hp/s.get("player").hpMax*this.radius*2),this.ctx.restore(),this.ctx.beginPath(),this.ctx.arc(this.centerX,this.canvas.height-this.radius-5,this.radius,0,2*Math.PI,!1),this.ctx.lineWidth=6,this.ctx.strokeStyle="#000000",this.ctx.stroke();var e=this.ctx.createLinearGradient(0,0,s.get("player").xp/s.get("player").xpMax*this.canvas.width,0);e.addColorStop(0,"darkgreen"),e.addColorStop(.75,"darkgreen"),e.addColorStop(.95,"lime"),e.addColorStop(1,"lime"),this.ctx.fillStyle=e,this.ctx.fillRect(0,this.canvas.height-10,s.get("player").xp/s.get("player").xpMax*this.canvas.width,10),this.ctx.fillStyle="black",this.ctx.textAlign="center",this.ctx.fillText((s.get("player").hp>0?Math.floor(s.get("player").hp):0)+" HP",this.centerX,this.canvas.height-this.radius)}}]),e}();window.addEventListener("keypress",function(e){73!=e.keyCode&&105!=e.keyCode||new l}),o(document).keyup(function(e){"escape"==e.key.toLowerCase()&&o("#pause").show()})},,function(e,t,i){"use strict";var n=i(5),a=i(4).NPC;new n.HUD,window.onerror=alert,window.Grove={version:"1.3.7",globals:i(0)},Math.interval=function(e,t){return Math.floor(Math.random()*(t-e+1)+e)},Array.prototype.has=function(e){return this.indexOf(e)>-1};window.wicket=new a("wicket",{pos:{},sounds:["wicket.mp3",null,"wicket-hurt.mp3","wicket-hurt.mp3"]});i(17)(),i(18)(),i(23)(),i(24),i(5)},,,,,,,function(e,t){e.exports={slime:{name:"Slime",path:"slime/slime",id:"slime",stats:{hp:3,hpMax:3,dmg:1,spd:5},hostility:[["wicket","player"],["slime","slime.red","slime.blue"],[]],inv:[{id:"gelatin",min:1,max:3}],mesh:[{name:"outer",transparent:!0,opacity:.3}]},"slime.red":{name:"Red Slime",path:"slime/slime",id:"slime.red",stats:{hp:5,hpMax:5,dmg:2,spd:5},hostility:[["wicket","player"],["slime","slime.red","slime.blue"],[]],inv:[{id:"gelatin",min:1,max:2}],meta:{spawn:[-500,200,250,300,310,390]},mesh:[{name:"outer",transparent:!0,opacity:.3,color:16711680},{name:"inner",color:16711680}]},"slime.blue":{name:"Blue Slime",path:"slime/slime",id:"slime.blue",stats:{hp:1,hpMax:1,dmg:7,spd:15},hostility:[["wicket","player"],["slime","slime.red","slime.blue"],[]],inv:[{id:"gelball",min:1,max:2}],mesh:[{name:"outer",transparent:!0,opacity:.3,color:255},{name:"inner",color:255}]}}},function(e,t){e.exports={gelatin:{name:"Gelatin",id:"gelatin",desc:"Like jello, but not edible.",path:"/assets/icons/gelatin.png",weight:1,value:3,effects:{hp:-1}},gelball:{name:"Ball of Gel",id:"gelball",desc:"Compressed gelatin, has distinctive healing properties.",path:"/assets/icons/slow-blob.png",weight:3,value:3,effects:{hp:5}}}},function(e,t){e.exports={wicket:{name:"Wicket",id:"wicket",path:"wicket/wicket",stats:{hp:30,hpMax:30,spd:20,dmg:15},hostility:[[],["player"],[]],meta:{spawn:[115,32,-30],sounds:["wicket.mp3","silence.wav","wicket-hurt.mp3","silence.wav"]}}}},function(e,t,i){"use strict";var n=i(4),a=i(2),s=(i(1),i(0)),o=s.get("world");e.exports=function(){o.quatNormalizeSkip=0,o.quatNormalizeFast=!1;var e=new a.GSSolver;o.defaultContactMaterial.contactEquationStiffness=1e9,o.defaultContactMaterial.contactEquationRelaxation=4,e.iterations=7,e.tolerance=.1;o.solver=new a.SplitSolver(e),o.gravity.set(0,-20,0),o.broadphase=new a.NaiveBroadphase;var t=new a.Material("slipperyMaterial"),i=new a.ContactMaterial(t,t,0,.3);o.addContactMaterial(i),s.set("player",new n.Player)}},function(e,t,i){"use strict";function n(){o.get("camera").aspect=window.innerWidth/window.innerHeight,o.get("camera").updateProjectionMatrix(),r.setSize(window.innerWidth,window.innerHeight),console.log("Window resized to "+window.innerWidth+", "+window.innerHeight)}var a=i(3),s=i(1),o=(i(2),i(0)),r=o.get("renderer"),l=o.get("scene");e.exports=function(){var e=i(19);s.DefaultLoadingManager.onProgress=function(e,t,i){console.log("Loading "+e+" ("+t+"/"+i+")"),a("#loaded").text(Math.floor(t/i*100)+"% - v."+window.Grove.version)},s.DefaultLoadingManager.onLoad=function(){console.log("Loading complete"),a("#instructions").has("h4").length||a("#instructions").html("\n        <h4>"+e[Math.floor(Math.random()*e.length)]+"</h4>\n        <button class='play-btn btn waves-effect waves-light light-green z-depth-3'>Play</button>\n        ").addClass("pntrlk")},s.DefaultLoadingManager.onError=function(e){console.error("Error loading "+e)},l.fog=new s.FogExp2(16777215,.005);var t=i(20).DayNight,c=new t.SunSphere;l.add(c.object3d);var h=new t.Skydom;l.add(h.object3d);var d=new t.SunLight;l.add(d.object3d);var u=1/6*Math.PI*2,p=new s.AmbientLight(2236962);l.add(p),o.get("events").subscribe("system.update",function(e){o.get("controls").enabled&&(u+=1e-5*Math.PI*2,c.update(u),h.update(u),d.update(u))});var m=i(21);o.set("controls",new m(o.get("camera"),o.get("player").body)),l.add(o.get("controls").getObject()),i(22)(o.get("controls")),(new s.ObjectLoader).load("/assets/3d/skjar-isles/skjar-isles.json",function(e){l.add(e),e.castShadow=!0,e.receiveShadow=!0,e.traverse(function(e){e.castShadow=!0,e.receiveShadow=!0,e instanceof s.Mesh&&!/NP/gi.test(e.name)?(console.log("Loading "+e.name),o.get("load")(e)):"NP_Ocean"==e.name&&(e.material.transparent=!0,e.material.opacity=.9)})}),r.shadowMap.enabled=!0,r.shadowMapSoft=!0,r.setSize(window.innerWidth,window.innerHeight),r.setClearColor(l.fog.color,1),document.body.appendChild(r.domElement),window.addEventListener("resize",n,!1)}},function(e,t){e.exports=["While the island's mountains may be fun to climb, keep a look out; they are teeming with some of The Grove's more formiddable creatures.","OOOOO OOOOO OOOOO - Hunter Sokolis, time unknown","There is currently no fall damage in the game - take advantage of that while you can.","A slime's power depends on its color. Green slimes are easy to beat, whereas red slimes are harder.","Please tolerate our crappy graphics","Can you find Hunter's hidden characters?","There will be an update to this game eventually. Keyword is eventually.","Can you find the mysterious ButtBook?","How many slimes can you kill?","Beware the foul-smelling train!","Did you know Wicket is a candle?","<span class='rune'>welcome young traveller</span> - ancient Grove folklore"]},function(e,t,i){"use strict";var n=i(1),a=e.exports=a||{};a.DayNight={},a.DayNight.baseURL="../",a.DayNight.currentPhase=function(e){return Math.sin(e)>Math.sin(0)?"day":Math.sin(e)>Math.sin(-Math.PI/6)?"twilight":"night"},a.DayNight.StarField=function(){var e=n.ImageUtils.loadTexture(a.DayNight.baseURL+"images/galaxy_starfield.png"),t=new n.MeshBasicMaterial({map:e,side:n.BackSide,color:8421504}),i=new n.SphereGeometry(4500,32,32),s=new n.Mesh(i,t);this.object3d=s,this.update=function(e){var i=a.DayNight.currentPhase(e);if("day"===i)s.visible=!1;else if("twilight"===i)s.visible=!1;else{s.visible=!0,s.rotation.y=e/5;var n=Math.abs(Math.sin(e));t.color.setRGB(n,n,n)}}},a.DayNight.SunLight=function(){var e=new n.DirectionalLight(16777215,1);this.object3d=e,this.update=function(t){e.position.x=0,e.position.y=9e4*Math.sin(t),e.position.z=9e4*Math.cos(t);var i=a.DayNight.currentPhase(t);"day"===i?e.color.set("rgb(255,"+(Math.floor(200*Math.sin(t))+55)+","+Math.floor(200*Math.sin(t))+")"):"twilight"===i?(e.intensity=1,e.color.set("rgb("+(255-Math.floor(510*Math.sin(t)*-1))+","+(55-Math.floor(110*Math.sin(t)*-1))+",0)")):e.intensity=1}},a.DayNight.SunSphere=function(){var e=new n.SphereGeometry(20,30,30),t=new n.MeshBasicMaterial({color:16711680}),i=new n.Mesh(e,t);this.object3d=i,this.update=function(e){i.position.x=0,i.position.y=400*Math.sin(e),i.position.z=400*Math.cos(e);var t=a.DayNight.currentPhase(e);"day"===t?i.material.color.set("rgb(255,"+(Math.floor(200*Math.sin(e))+55)+","+(Math.floor(200*Math.sin(e))+5)+")"):"twilight"===t&&i.material.color.set("rgb(255,55,5)")}},a.DayNight.Skydom=function(){var e=new n.SphereGeometry(4500,32,15),t=a.DayNight.Skydom.Shader,i=n.UniformsUtils.clone(t.uniforms),s=new n.ShaderMaterial({vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,uniforms:i,side:n.BackSide}),o=new n.Mesh(e,s);this.object3d=o,this.update=function(e){var t=a.DayNight.currentPhase(e);"day"===t?(i.topColor.value.set("rgb(0,120,255)"),i.bottomColor.value.set("rgb(255,"+(Math.floor(200*Math.sin(e))+55)+","+Math.floor(200*Math.sin(e))+")")):"twilight"===t?(i.topColor.value.set("rgb(0,"+(120-Math.floor(240*Math.sin(e)*-1))+","+(255-Math.floor(510*Math.sin(e)*-1))+")"),i.bottomColor.value.set("rgb("+(255-Math.floor(510*Math.sin(e)*-1))+","+(55-Math.floor(110*Math.sin(e)*-1))+",0)")):(i.topColor.value.set("black"),i.bottomColor.value.set("black"))}},a.DayNight.Skydom.Shader={uniforms:{topColor:{type:"c",value:(new n.Color).setHSL(.6,1,.75)},bottomColor:{type:"c",value:new n.Color(16777215)},offset:{type:"f",value:400},exponent:{type:"f",value:.6}},vertexShader:["varying vec3 vWorldPosition;","void main() {","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tvWorldPosition = worldPosition.xyz;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec3 topColor;","uniform vec3 bottomColor;","uniform float offset;","uniform float exponent;","varying vec3 vWorldPosition;","void main() {","\tfloat h = normalize( vWorldPosition + offset ).y;","\tgl_FragColor = vec4( mix( bottomColor, topColor, max( pow( h, exponent ), 0.0 ) ), 1.0 );","}"].join("\n")}},function(e,t,i){"use strict";var n=i(1),a=i(2),s=i(0);e.exports=function(e,t){var i=new Audio("/assets/sfx/leaves01.ogg"),o=this,r=new n.Object3D;r.add(e);var l=new n.Object3D;l.position.y=2,l.add(r);var c=new n.Quaternion,h=!1,d=!1,u=!1,p=!1,m=!1,v=!1,y=new a.Vec3,f=new a.Vec3(0,1,0);t.addEventListener("collide",function(e){var i=e.contact;i.bi.id==t.id?i.ni.negate(y):y.copy(i.ni),y.dot(f)>.5&&(m=!0)});var g=t.velocity,w=Math.PI/2,b=function(e){if(!1!==o.enabled){var t=e.movementX||e.mozMovementX||e.webkitMovementX||0,i=e.movementY||e.mozMovementY||e.webkitMovementY||0;l.rotation.y-=.002*t,r.rotation.x-=.002*i,r.rotation.x=Math.max(-w,Math.min(w,r.rotation.x)),s.get("events").publish("player.look",{pitch:r.rotation,yaw:l.rotation})}},x=function(e){switch(e.keyCode){case 38:case 87:h=!0,s.get("events").publish("player.move",{});break;case 37:case 65:u=!0,s.get("events").publish("player.move",{});break;case 40:case 83:d=!0,s.get("events").publish("player.move",{});break;case 39:case 68:p=!0,s.get("events").publish("player.move",{});break;case 32:!0===m&&(g.y=10,s.get("events").publish("player.jump",{})),m=!1;break;case 16:v=!0}},k=function(e){switch(e.keyCode){case 38:case 87:h=!1;break;case 37:case 65:u=!1;break;case 40:case 83:d=!1;break;case 39:case 68:p=!1;break;case 16:v=!1}};document.addEventListener("mousemove",b,!1),document.addEventListener("touchmove",b,!1),document.addEventListener("keydown",x,!1),document.addEventListener("keyup",k,!1),this.enabled=!1,this.getObject=function(){return l},this.getDirection=function(e){e.set(0,0,-1),c.multiplyVector3(e)};var M=new n.Vector3,S=new n.Euler;this.update=function(e){if(!1!==o.enabled){e*=.1,M.set(0,0,0);var n=s.get("player").spd;v&&s.get("player").stm>0&&(s.get("player").lastUsedStamina=Date.now(),n*=2,s.get("player").stm-=.1),h&&(M.z=-n*e),d&&(M.z=n*e),u&&(M.x=-n*e),p&&(M.x=n*e),S.y=l.rotation.y,S.order="XYZ",c.setFromEuler(S),M.applyQuaternion(c),g.x+=M.x,g.z+=M.z,(Math.abs(g.x)>4||Math.abs(g.z)>4)&&m&&(h||d||u||p)?i.play():h||d||u||p||!m||(g.x*=.675,g.z*=.675),l.position.copy(t.position)}}}},function(e,t,i){"use strict";var n=i(3),a=i(0);e.exports=function(e){var t=document.getElementById("blocker"),i=document.getElementById("instructions");if("pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document){var s=document.body,o=function(i){a.get("events").publish("system.pointerlock.enter",{}),document.pointerLockElement===s||document.mozPointerLockElement===s||document.webkitPointerLockElement===s?(e.enabled=!0,t.style.display="none"):e.enabled=!1},r=function(e){i.style.display=""};document.addEventListener("pointerlockchange",o,!1),document.addEventListener("mozpointerlockchange",o,!1),document.addEventListener("webkitpointerlockchange",o,!1),document.addEventListener("pointerlockerror",r,!1),document.addEventListener("mozpointerlockerror",r,!1),document.addEventListener("webkitpointerlockerror",r,!1),setInterval(function(){n(".pntrlk").click(function(e){if(i.style.display="none",s.requestPointerLock=s.requestPointerLock||s.mozRequestPointerLock||s.webkitRequestPointerLock,/Firefox/i.test(navigator.userAgent)){var t=function e(t){document.fullscreenElement!==s&&document.mozFullscreenElement!==s&&document.mozFullScreenElement!==s||(document.removeEventListener("fullscreenchange",e),document.removeEventListener("mozfullscreenchange",e),s.requestPointerLock())};document.addEventListener("fullscreenchange",t,!1),document.addEventListener("mozfullscreenchange",t,!1),s.requestFullscreen=s.requestFullscreen||s.mozRequestFullscreen||s.mozRequestFullScreen||s.webkitRequestFullscreen,s.requestFullscreen()}else s.requestPointerLock()})},500)}else i.innerHTML="Your browser doesn't seem to support Pointer Lock API"}},function(e,t,i){"use strict";var n=i(4),a=i(0),s=i(3),o=i(1);i(2);e.exports=function e(t){requestAnimationFrame(e),a.get("controls").enabled&&a.get("world").step(1/60);var i=!0,r=!1,l=void 0;try{for(var c,h=a.get("entities")[Symbol.iterator]();!(i=(c=h.next()).done);i=!0){c.value.update(t)}}catch(e){r=!0,l=e}finally{try{!i&&h.return&&h.return()}finally{if(r)throw l}}var d=!0,u=!1,p=void 0;try{for(var m,v=a.get("tweens")[Symbol.iterator]();!(d=(m=v.next()).done);d=!0){m.value.update(t)}}catch(e){u=!0,p=e}finally{try{!d&&v.return&&v.return()}finally{if(u)throw p}}if(a.get("entities").length<30){var y="slime";Math.random()<.25?y="slime.red":Math.random()<.05&&(y="slime.blue");new n.Creature(y,{pos:{x:Math.interval(a.get("player").mesh.position.x-200,a.get("player").mesh.position.x+200),y:30,z:Math.interval(a.get("player").mesh.position.z-200,a.get("player").mesh.position.z+200),override:!1},sounds:[null,"slime-attack.wav","slime-hurt.wav","slime-die.wav"]})}a.get("player").body.position.y<-100?a.get("player").body.position.set(0,15,0):a.get("player").body.position.y<-20?s("#overlay").css("background","blue").css("opacity",.5).show():s("#overlay").hide(),a.get("controls").update(Date.now()-a.get("time")),a.get("renderer").render(a.get("scene"),a.get("camera")),a.set("time",Date.now()),a.set("tick",a.get("tick")+1);var f=new o.Raycaster;f.set(a.get("camera").getWorldPosition(),a.get("camera").getWorldDirection());var g=!0,w=!1,b=void 0;try{for(var x,k=a.get("entities")[Symbol.iterator]();!(g=(x=k.next()).done);g=!0){var M=x.value;f.intersectObjects(M.mesh.children,!0).length?(s("#label").html(M.data.name+" ("+M.hp+"/"+M.hpMax+")"),s("#crosshair").attr("src","/assets/img/crosshair/crosshair-enemy.png")):a.get("tick")%30==0&&(s("#label").html(""),s("#crosshair").attr("src","/assets/img/crosshair/crosshair.png"))}}catch(e){w=!0,b=e}finally{try{!g&&k.return&&k.return()}finally{if(w)throw b}}a.get("events").publish("system.update",{delta:t})}},function(e,t,i){"use strict";function n(e){if(r.get("controls").enabled){var t=new s.Raycaster;if(t.set(r.get("camera").getWorldPosition(),r.get("camera").getWorldDirection()),l&&Date.now()-r.get("player").lastAttacked>800){r.get("events").publish("player.attack",{});var i=new o.Tween(l.rotation).to({x:[-Math.PI/2,0]},800).onStart(function(){c.play()}).start();r.get("tweens").push(i),r.get("player").lastAttacked=Date.now();var n=!0,a=!1,h=void 0;try{for(var d,u=r.get("entities")[Symbol.iterator]();!(n=(d=u.next()).done);n=!0){var p=d.value;t.intersectObjects(p.mesh.children,!0).length&&r.get("player").mesh.position.distanceTo(p.mesh.position)<5&&(p.callEvent("click"),r.get("player").attack(p))}}catch(e){a=!0,h=e}finally{try{!n&&u.return&&u.return()}finally{if(a)throw h}}}}}function a(e){var t=new s.Raycaster;t.set(r.get("camera").getWorldPosition(),r.get("camera").getWorldDirection());var i=!0,n=!1,a=void 0;try{for(var o,l=r.get("entities")[Symbol.iterator]();!(i=(o=l.next()).done);i=!0){var c=o.value;t.intersectObjects(c.mesh.children,!0).length&&c.callEvent("interact")}}catch(e){n=!0,a=e}finally{try{!i&&l.return&&l.return()}finally{if(n)throw a}}}var s=i(1),o=i(6),r=i(0),l=void 0,c=new Audio("/assets/sfx/sword.mp3");c.volume=.1,window.addEventListener("mousedown",function(e){r.get("events").publish("system.click",e),2==e.which||4==e.button?a(e):n(e)}),window.addEventListener("keyup",function(e){return!(69==e.keyCode)||a()}),(new s.ObjectLoader).load("/assets/3d/sword/sword.json",function(e){r.get("camera").add(e),e.scale.set(.1,.1,.1),e.position.x++,e.position.y-=1.2,e.position.z-=1.25,l=e})}],[7]);